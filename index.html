<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clinical Wellness Spa</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0284C7">
    
    <!-- iOS PWA Tags -->
    <link rel="apple-touch-icon" href="images/icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    brand: {
                        light: '#E0F2FE', // Light blue
                        DEFAULT: '#0EA5E9', // Sky blue 500
                        dark: '#0284C7',  // Sky blue 700
                    },
                },
                keyframes: {
                    'fade-in': {
                        '0%': { opacity: '0' },
                        '100%': { opacity: '1' },
                    },
                    'slide-in-up': {
                        '0%': { transform: 'translateY(20px)', opacity: '0' },
                        '100%': { transform: 'translateY(0)', opacity: '1' },
                    },
                     'slide-in-bottom': {
                        '0%': { transform: 'translateY(100%)', opacity: '0' },
                        '100%': { transform: 'translateY(0)', opacity: '1' },
                    },
                    'toast-in': {
                        '0%': { transform: 'translateY(-20px) scale(0.9)', opacity: '0' },
                        '100%': { transform: 'translateY(0) scale(1)', opacity: '1' },
                    },
                    'toast-out': {
                        '0%': { transform: 'translateY(0) scale(1)', opacity: '1' },
                        '100%': { transform: 'translateY(-20px) scale(0.9)', opacity: '0' },
                    },
                    'spin': {
                        'from': { transform: 'rotate(0deg)' },
                        'to': { transform: 'rotate(360deg)' },
                    },
                },
                animation: {
                    'fade-in': 'fade-in 0.5s ease-out',
                    'slide-in-up': 'slide-in-up 0.5s ease-out',
                    'slide-in-bottom': 'slide-in-bottom 0.3s ease-out forwards',
                    'toast-in': 'toast-in 0.3s ease-out forwards',
                    'toast-out': 'toast-out 0.3s ease-out forwards',
                    'spin': 'spin 1s linear infinite',
                },
            }
        }
    }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .sidebar-icon {
            width: 24px;
            height: 24px;
        }
    </style>
    <script src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-slate-50">
    <div id="root"></div>
    <script type="text/babel" data-presets="react,typescript">
// --- ICONS ---
const HomeIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></svg>
);
const UserIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>
);
const BookOpenIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></svg>
);
const BeakerIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4.5 3h15" /><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-16V3" /><path d="M6 14h12" /></svg>
);
const ClipboardPlusIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M9 14h6"/><path d="M12 11v6"/></svg>
);
const MenuIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
);
const XIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18" /><path d="m6 6 12 12" /></svg>
);
const XCircleIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
);
const LoginIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>
);
const CalendarClockIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5"/><path d="M16 2v4"/><path d="M8 2v4"/><path d="M3 10h18"/><path d="M18 22a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"/><path d="M18 16.5V18l.5.5"/></svg>
);
const AreaChartIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="M7 12v5h12V8l-5 5-4-4Z"/></svg>
);
const SparklesIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.45 4.1-4.1-1.45L8 12l-5.55 1.45 4.1 1.45L12 21l1.45-4.1 4.1 1.45L16 12l5.55-1.45-4.1-1.45Z"/></svg>
);
const MailIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
);
const WhatsAppIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M16.75 13.96c.25.13.42.2.55.32.13.13.2.27.2.42s-.07.28-.2.42c-.13.13-.27.2-.42.2h-.13c-.32 0-.68-.07-1.1-.2-1.25-.42-2.25-1.18-2.97-2.18-.72-1-1.1-2.13-1.1-3.36 0-.2.07-.37.2-.5.13-.13.27-.2.42-.2h.13c.13 0 .25.03.35.1.1.07.17.15.22.25.1.13.17.3.22.5s.1.42.13.65c.03.23.03.45.03.63 0 .2-.03.4-.1.55-.07.15-.15.28-.25.4-.1.1-.18.18-.25.25-.07.07-.13.12-.17.15-.04.03-.07.07-.07.13s0 .1.03.13c.03.03.07.07.1.13.17.2.38.45.65.7.27.28.5.5.75.7s.48.37.7.5c.07.03.12.06.15.08.03.02.06.03.08.03s.04.02.06.03c.02.01.05.02.08.03.03.01.07.02.1.03.1.03.2.07.3.13.03.03.06.05.08.06.02.01.05.03.08.04.03.01.07.02.1.03l.03.01h.02c.03 0 .07-.02.1-.03.17-.07.32-.15.45-.25s.22-.2.3-.3c.08-.1.13-.2.15-.28.02-.08.03-.17.03-.25 0-.1-.02-.2-.05-.3-.03-.1-.08-.2-.13-.3s-.12-.18-.2-.28c-.08-.1-.15-.18-.2-.25-.05-.07-.1-.13-.13-.18s-.05-.1-.05-.13a.14.14 0 0 1 .03-.1c.01-.02.03-.03.05-.04.1-.05.2-.1.3-.15s.18-.1.25-.13c.07-.03.13-.05.17-.05.04 0 .08.02.1.03s.05.03.06.05c.01.02.03.03.03.05.01.02.02.05.02.08s-.02.07-.03.1c-.01.03-.03.06-.05.08l-.05.08c-.03.03-.05.06-.06.08a.2.2 0 0 0-.02.1c0 .03.01.06.03.1.02.03.05.06.1.1l.4.45c.1.13.2.25.3.37.1.12.2.23.3.32.1.1.2.18.3.25.1.07.2.13.28.17.08.04.17.07.25.1.08.03.17.04.25.04.13 0 .25-.02.37-.05.12-.03.24-.08.36-.15.12-.07.23-.15.33-.25.1-.1.18-.2.25-.32.07-.12.12-.24.15-.37.03-.13.05-.25.05-.38 0-.2-.07-.38-.2-.53-.13-.15-.3-.28-.5-.38-.2-.1-.42-.16-.65-.18-.23-.02-.48-.03-.7-.03-.23 0-.45.01-.65.03-.2.02-.4.06-.55.13-.15.07-.3.15-.42.25-.12.1-.23.2-.3.3s-.15.2-.2.3c-.05.1-.1.2-.13.3s-.05.2-.05.3v.1c0 .07.02.13.05.18.03.05.08.1.13.15l.35.35c.05.05.1.1.13.15l.13.15c.03.03.05.06.06.1a.24.24 0 0 1 0 .2c-.01.04-.03.08-.06.1-.03.03-.06.05-.1.06-.04.01-.08.02-.1.02-.03 0-.06,0-.08-.01s-.05-.02-.08-.03a.55.55 0 0 1-.13-.06c-.05-.03-.1-.06-.15-.1-.2-.13-.4-.28-.6-.45-.2-.17-.38-.35-.55-.52-.17-.17-.33-.35-.48-.52s-.28-.33-.4-.48c-.05-.07-.1-.13-.15-.2s-.1-.13-.13-.2c-.03-.07-.05-.13-.05-.2v-.12c0-.04.01-.08.03-.1.02-.03.05-.05.08-.06.03-.01.07-.02.1-.02h.1c.07 0 .13.02.18.05.05.03.1.08.15.13.1.13.2.25.3.37.1.12.18.23.25.32.07.1.13.18.17.25.04.07.08.13.1.18.02.05.03.1.03.13s-.01.07-.03.1a.1.1 0 0 1-.08.05c-.03.01-.07.01-.1 0-.03 0-.06-.01-.08-.02s-.05-.02-.08-.03c-.07-.03-.15-.07-.22-.1-.07-.03-.15-.07-.22-.1s-.15-.07-.22-.1c-.07-.03-.15-.05-.22-.07-.2-.05-.4-.08-.6-.08-.17 0-.33.02-.5.05-.17.03-.32.08-.47.15-.15.07-.28.16-.4.27-.12.11-.22.23-.3.37zM12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z"></path></svg>
);
const LoaderIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
);
const TrendingDownIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></svg>
);
const LungIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 21c4-4 6-10 6-14a6 6 0 0 0-12 0c0 4 2 10 6 14Z"/><path d="M12 15v6"/><path d="M8 12c-2-2.5-2.5-6-1-8 1.5-2 4-2.5 6-1"/><path d="M16 12c2-2.5 2.5-6 1-8-1.5-2-4-2.5-6-1"/></svg>
);
const CheckCircleIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
);
const ArrowLeftIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
);
const LockIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></svg>
);
const KeyIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.6 9.6"/><path d="m15.5 7.5 3 3L22 7l-3-3"/></svg>
);
const BellIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" /><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" /></svg>
);


// --- CONSTANTS ---
const PHARMACY_EMAIL = 'farmaciacentrale.montesilvano@gmail.com';
const PHARMACY_WHATSAPP_NUMBER = '393400600600';

const levelPasswords = {
    // Alimentazione
    'food_level_2': 'energiaCucina',
    'food_level_3': 'gourmetMaster',
    // Ansia-Stress
    'anxiety_stress_level_2': 'oasiTranquilla',
    'anxiety_stress_level_3': 'superZen',
    // Sonno
    'sleep_level_2': 'sognoCalmo',
    'sleep_level_3': 'notteMagica',
    'sleep_level_4': 'sonnoProfondo',
    // Movimento
    'activity_sprint_2': 'energiaMovimento',
    'activity_sprint_3': 'eccellenzaAtletica',
};

const passwordSummary = [
    { program: 'Alimentazione', level: 'Livello 2 – Energia in Cucina', password: 'energiaCucina' },
    { program: 'Alimentazione', level: 'Livello 3 – Sfida del Gourmet', password: 'gourmetMaster' },
    { program: 'Ansia-Stress', level: 'Livello 2 – Oasi della Tranquillità', password: 'oasiTranquilla' },
    { program: 'Ansia-Stress', level: 'Livello 3 – Super Zen', password: 'superZen' },
    { program: 'Sonno', level: 'Livello 2 – Sogno Calmo', password: 'sognoCalmo' },
    { program: 'Sonno', level: 'Livello 3 – Notte Magica', password: 'notteMagica' },
    { program: 'Sonno', level: 'Livello 4 – Sonno Profondo', password: 'sonnoProfondo' },
    { program: 'Movimento', level: 'Livello 2 – Energia in Movimento', password: 'energiaMovimento' },
    { program: 'Movimento', level: 'Livello 3 – Eccellenza Atletica', password: 'eccellenzaAtletica' },
];


// --- DATA ---
const assessmentsData = {
  sleep: {
    id: 'sleep',
    title: 'Analisi del Sonno',
    Icon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22h6a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2h6z"/><path d="M12 2v4"/><path d="M20 12v-2a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>,
    questions: [
        { text: "Quante ore dormi in media per notte?", options: [{ text: "Meno di 5 ore", value: 1 }, { text: "5-6 ore", value: 2 }, { text: "7-8 ore", value: 4 }, { text: "Più di 8 ore", value: 3 }] },
        { text: "Ti svegli durante la notte?", options: [{ text: "Spesso", value: 1 }, { text: "A volte", value: 2 }, { text: "Raramente", value: 3 }, { text: "Mai", value: 4 }] },
        { text: "Come ti senti al risveglio?", options: [{ text: "Stanco e non riposato", value: 1 }, { text: "Leggermente stanco", value: 2 }, { text: "Abbastanza riposato", value: 3 }, { text: "Pieno di energie", value: 4 }] },
        { text: "Quanto tempo impieghi per addormentarti?", options: [{ text: "Più di 60 minuti", value: 1 }, { text: "30-60 minuti", value: 2 }, { text: "15-30 minuti", value: 3 }, { text: "Meno di 15 minuti", value: 4 }] },
        { text: "Usi dispositivi elettronici (telefono, TV) prima di dormire?", options: [{ text: "Sempre, fino a un attimo prima", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente o mai", value: 4 }] },
        { text: "La tua camera da letto è buia e silenziosa?", options: [{ text: "No, è luminosa e/o rumorosa", value: 1 }, { text: "Abbastanza", value: 2 }, { text: "Sì, per la maggior parte", value: 3 }, { text: "Sì, completamente", value: 4 }] },
        { text: "Ti capita di russare o avere apnee notturne?", options: [{ text: "Sì, mi è stato detto spesso", value: 1 }, { text: "A volte", value: 2 }, { text: "Non che io sappia", value: 3 }, { text: "No, mai", value: 4 }] },
        { text: "Hai orari di sonno regolari (anche nel weekend)?", options: [{ text: "No, molto irregolari", value: 1 }, { text: "Abbastanza irregolari", value: 2 }, { text: "Abbastanza regolari", value: 3 }, { text: "Sì, molto regolari", value: 4 }] },
        { text: "Bevi caffè o alcolici nelle ore serali?", options: [{ text: "Sì, regolarmente", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente o mai", value: 4 }] },
        { text: "Fai attività fisica intensa poco prima di coricarti?", options: [{ text: "Sì, regolarmente", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente o mai", value: 4 }] },
        { text: "Ti senti assonnato durante il giorno?", options: [{ text: "Molto, fatico a rimanere sveglio", value: 1 }, { text: "Abbastanza", value: 2 }, { text: "Un po'", value: 3 }, { text: "Per niente", value: 4 }] },
        { text: "Fai sonnellini durante il giorno?", options: [{ text: "Sì, lunghi e spesso", value: 1 }, { text: "Sì, ma brevi (meno di 30 min)", value: 3 }, { text: "Raramente", value: 4 }, { text: "Quasi mai", value: 2 }] },
        { text: "La temperatura della tua camera è confortevole?", options: [{ text: "No, troppo calda o troppo fredda", value: 1 }, { text: "A volte sì, a volte no", value: 2 }, { text: "Generalmente sì", value: 3 }, { text: "Sì, è ideale", value: 4 }] },
        { text: "Il tuo materasso e cuscino sono comodi?", options: [{ text: "No, per niente", value: 1 }, { text: "Potrebbero essere migliori", value: 2 }, { text: "Sì, abbastanza", value: 3 }, { text: "Sì, molto comodi", value: 4 }] },
        { text: "Hai pensieri stressanti o ansiosi quando vai a letto?", options: [{ text: "Sì, quasi ogni sera", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Ceni molto tardi o in modo pesante?", options: [{ text: "Sì, quasi sempre", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente o mai", value: 4 }] },
        { text: "Ti alzi per andare in bagno durante la notte?", options: [{ text: "Più di due volte", value: 1 }, { text: "Una o due volte", value: 2 }, { text: "Raramente", value: 3 }, { text: "Mai", value: 4 }] },
        { text: "Come giudicheresti la qualità generale del tuo sonno?", options: [{ text: "Molto scarsa", value: 1 }, { text: "Scarsa", value: 2 }, { text: "Buona", value: 3 }, { text: "Eccellente", value: 4 }] },
        { text: "Soffri di crampi o sindrome delle gambe senza riposo?", options: [{ text: "Sì, frequentemente", value: 1 }, { text: "A volte", value: 2 }, { text: "Raramente", value: 3 }, { text: "Mai", value: 4 }] },
        { text: "Assumi farmaci o integratori per dormire?", options: [{ text: "Sì, regolarmente", value: 1 }, { text: "Occasionalmente", value: 2 }, { text: "Molto raramente", value: 3 }, { text: "Mai", value: 4 }] },
    ],
    results: [
        { scoreMin: 20, scoreMax: 40, title: 'Qualità del sonno molto scarsa', summary: 'Il tuo sonno sembra essere significativamente disturbato. È fondamentale indagare le cause e adottare strategie mirate per migliorare il riposo notturno.' },
        { scoreMin: 41, scoreMax: 60, title: 'Qualità del sonno migliorabile', summary: 'Ci sono diversi aspetti del tuo sonno che possono essere migliorati. Piccoli cambiamenti nelle tue abitudini potrebbero fare una grande differenza.' },
        { scoreMin: 61, scoreMax: 80, title: 'Buona qualità del sonno', summary: 'Hai delle buone abitudini di sonno, ma c\'è ancora margine per ottimizzare il tuo riposo e massimizzare i benefici per la tua salute.' },
    ],
  },
  fitness: {
    id: 'fitness',
    title: 'Analisi Fitness',
    Icon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5C12 5 12 5 12 5c-2.2 0-4 1.8-4 4v0c0 1.1.9 2 2 2h4c1.1 0 2-.9 2-2v0c0-2.2-1.8-4-4-4z"/><path d="M12 11v11"/><path d="M10 11H8c-1.1 0-2 .9-2 2v0c0 2.2 1.8 4 4 4h0"/><path d="M14 11h2c1.1 0 2 .9 2 2v0c0 2.2-1.8 4-4 4h0"/><circle cx="12" cy="5" r="2"/></svg>,
    questions: [
        { text: "Quante volte a settimana fai attività fisica aerobica (corsa, nuoto, bici)?", options: [{ text: "Mai", value: 1 }, { text: "1-2 volte", value: 2 }, { text: "3-4 volte", value: 3 }, { text: "5 o più volte", value: 4 }] },
        { text: "Quanto dura in media una tua sessione di allenamento?", options: [{ text: "Meno di 20 minuti", value: 1 }, { text: "20-40 minuti", value: 2 }, { text: "40-60 minuti", value: 3 }, { text: "Più di 60 minuti", value: 4 }] },
        { text: "Includi esercizi di forza (pesi, corpo libero) nella tua routine?", options: [{ text: "Mai", value: 1 }, { text: "Raramente", value: 2 }, { text: "1-2 volte a settimana", value: 3 }, { text: "3 o più volte a settimana", value: 4 }] },
        { text: "Come percepisci l'intensità del tuo allenamento tipico?", options: [{ text: "Molto leggera", value: 1 }, { text: "Leggera", value: 2 }, { text: "Moderata", value: 3 }, { text: "Intensa", value: 4 }] },
        { text: "Fai stretching o esercizi di flessibilità?", options: [{ text: "Mai", value: 1 }, { text: "Raramente", value: 2 }, { text: "Dopo ogni allenamento", value: 4 }, { text: "Alcune volte a settimana", value: 3 }] },
        { text: "Quanti passi fai in media al giorno?", options: [{ text: "Meno di 3.000", value: 1 }, { text: "3.000 - 6.000", value: 2 }, { text: "6.000 - 10.000", value: 3 }, { text: "Più di 10.000", value: 4 }] },
        { text: "Passi la maggior parte della tua giornata seduto?", options: [{ text: "Sì, quasi tutto il giorno", value: 1 }, { text: "Sì, più di metà giornata", value: 2 }, { text: "No, sono spesso in movimento", value: 3 }, { text: "No, ho un lavoro molto attivo", value: 4 }] },
        { text: "Riesci a salire 3 piani di scale senza affanno eccessivo?", options: [{ text: "No, con molta fatica", value: 1 }, { text: "Sì, ma con un po' di affanno", value: 2 }, { text: "Sì, abbastanza facilmente", value: 3 }, { text: "Sì, senza problemi", value: 4 }] },
        { text: "Ti dedichi al riscaldamento prima dell'allenamento e al defaticamento dopo?", options: [{ text: "Mai", value: 1 }, { text: "Raramente", value: 2 }, { text: "A volte", value: 3 }, { text: "Sempre", value: 4 }] },
        { text: "Come ti senti dopo un'attività fisica?", options: [{ text: "Esausto e dolorante per giorni", value: 1 }, { text: "Molto stanco", value: 2 }, { text: "Piacevolmente stanco", value: 3 }, { text: "Energizzato", value: 4 }] },
        { text: "Hai un obiettivo di fitness specifico (es. perdere peso, aumentare la massa muscolare)?", options: [{ text: "No, nessuno", value: 1 }, { text: "Sì, ma non lo seguo con costanza", value: 2 }, { text: "Sì, e lo seguo abbastanza bene", value: 3 }, { text: "Sì, e sono molto disciplinato", value: 4 }] },
        { text: "La tua routine di allenamento è varia?", options: [{ text: "No, faccio sempre le stesse cose", value: 1 }, { text: "Non molto, vario raramente", value: 2 }, { text: "Sì, cerco di variare", value: 3 }, { text: "Sì, è molto diversificata", value: 4 }] },
        { text: "Ti alleni da solo o in compagnia?", options: [{ text: "Sempre da solo", value: 2 }, { text: "Preferibilmente in compagnia", value: 3 }, { text: "Dipende, entrambi", value: 4 }, { text: "Non mi alleno", value: 1 }] },
        { text: "Quanto è importante l'attività fisica nella tua vita?", options: [{ text: "Per niente", value: 1 }, { text: "Poco", value: 2 }, { text: "Abbastanza", value: 3 }, { text: "Molto", value: 4 }] },
        { text: "Hai mai avuto infortuni legati all'attività fisica?", options: [{ text: "Sì, e mi impedisce di allenarmi", value: 1 }, { text: "Sì, più di uno in passato", value: 2 }, { text: "Sì, ma di lieve entità", value: 3 }, { text: "No, mai", value: 4 }] },
        { text: "Come recuperi dopo l'allenamento (sonno, alimentazione)?", options: [{ text: "Non ci presto attenzione", value: 1 }, { text: "Potrei fare di più", value: 2 }, { text: "Ci sto attento", value: 3 }, { text: "Il recupero è una mia priorità", value: 4 }] },
        { text: "Ascolti i segnali del tuo corpo (es. ti fermi se senti dolore)?", options: [{ text: "No, tendo a ignorarli", value: 1 }, { text: "Non sempre", value: 2 }, { text: "Generalmente sì", value: 3 }, { text: "Sì, sempre", value: 4 }] },
        { text: "Ti idrati a sufficienza durante il giorno e l'allenamento?", options: [{ text: "No, bevo molto poco", value: 1 }, { text: "Potrei bere di più", value: 2 }, { text: "Sì, bevo regolarmente", value: 3 }, { text: "Sì, sono molto attento all'idratazione", value: 4 }] },
        { text: "La tua motivazione ad allenarti è costante?", options: [{ text: "No, è molto altalenante", value: 1 }, { text: "A volte c'è, a volte no", value: 2 }, { text: "È abbastanza costante", value: 3 }, { text: "Sì, sono molto motivato", value: 4 }] },
        { text: "Come giudichi il tuo attuale livello di forma fisica?", options: [{ text: "Molto scarso", value: 1 }, { text: "Scarsa", value: 2 }, { text: "Buono", value: 3 }, { text: "Eccellente", value: 4 }] },
    ],
    results: [
        { scoreMin: 20, scoreMax: 40, title: 'Livello di fitness da migliorare', summary: 'La tua routine di attività fisica sembra essere limitata. Incrementare gradualmente l\'esercizio fisico porterebbe notevoli benefici alla tua salute generale.' },
        { scoreMin: 41, scoreMax: 60, title: 'Livello di fitness discreto', summary: 'Hai una base di attività fisica, ma c\'è un ampio margine di miglioramento. Aumentare la frequenza, la durata o l\'intensità potrebbe essere il prossimo passo.' },
        { scoreMin: 61, scoreMax: 80, title: 'Buon livello di fitness', summary: 'Sei una persona attiva e hai un buon livello di forma fisica. Continua così e valuta di inserire nuove sfide per mantenere alta la motivazione.' },
    ],
  },
  stress: {
    id: 'stress',
    title: 'Analisi Ansia e Stress',
    Icon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22c-3.3 0-6-2.7-6-6v-2a6 6 0 1 1 12 0v2c0 3.3-2.7 6-6 6z"/><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/><path d="M12 4V2"/><path d="M12 20v2"/><path d="m4.9 4.9 1.4 1.4"/><path d="m17.7 17.7 1.4 1.4"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m4.9 19.1 1.4-1.4"/><path d="m17.7 6.3 1.4-1.4"/></svg>,
    questions: [
        { text: "Con che frequenza ti senti nervoso o ansioso?", options: [{ text: "Quasi ogni giorno", value: 1 }, { text: "Più della metà dei giorni", value: 2 }, { text: "Alcuni giorni", value: 3 }, { text: "Raramente o mai", value: 4 }] },
        { text: "Riesci a controllare le tue preoccupazioni?", options: [{ text: "No, è molto difficile", value: 1 }, { text: "A volte, con sforzo", value: 2 }, { text: "Generalmente sì", value: 3 }, { text: "Sì, facilmente", value: 4 }] },
        { text: "Ti capita di sentirti improvvisamente spaventato o in preda al panico?", options: [{ text: "Spesso", value: 1 }, { text: "A volte", value: 2 }, { text: "Raramente", value: 3 }, { text: "Mai", value: 4 }] },
        { text: "Hai difficoltà a rilassarti?", options: [{ text: "Sì, quasi sempre", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Ti senti irritabile o ti arrabbi facilmente?", options: [{ text: "Molto spesso", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Hai difficoltà di concentrazione?", options: [{ text: "Sì, quasi sempre", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Soffri di mal di testa, mal di stomaco o tensioni muscolari inspiegabili?", options: [{ text: "Sì, frequentemente", value: 1 }, { text: "A volte", value: 2 }, { text: "Raramente", value: 3 }, { text: "Mai", value: 4 }] },
        { text: "Dedichi del tempo ad attività che ti rilassano (hobby, meditazione, ecc.)?", options: [{ text: "Mai", value: 1 }, { text: "Raramente", value: 2 }, { text: "A volte", value: 3 }, { text: "Regolarmente", value: 4 }] },
        { text: "Ti senti sopraffatto dalle tue responsabilità?", options: [{ text: "Quasi sempre", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Hai qualcuno con cui parlare apertamente dei tuoi problemi?", options: [{ text: "No, nessuno", value: 1 }, { text: "Poche persone", value: 2 }, { text: "Sì, alcuni amici/familiari", value: 3 }, { text: "Sì, una solida rete di supporto", value: 4 }] },
        { text: "Come gestisci le situazioni impreviste o i cambiamenti?", options: [{ text: "Vado in panico", value: 1 }, { text: "Con molta difficoltà", value: 2 }, { text: "Mi adatto, anche se con fatica", value: 3 }, { text: "Con flessibilità", value: 4 }] },
        { text: "Ti senti ottimista riguardo al futuro?", options: [{ text: "No, per niente", value: 1 }, { text: "Poco", value: 2 }, { text: "Abbastanza", value: 3 }, { text: "Sì, molto", value: 4 }] },
        { text: "Hai problemi a prendere decisioni?", options: [{ text: "Sì, anche per le piccole cose", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Ti senti stanco o senza energie anche senza sforzo fisico?", options: [{ text: "Quasi sempre", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Il tuo appetito è cambiato a causa dello stress (mangi di più o di meno)?", options: [{ text: "Sì, è cambiato notevolmente", value: 1 }, { text: "Un po'", value: 2 }, { text: "Non che io abbia notato", value: 3 }, { text: "No, è rimasto uguale", value: 4 }] },
        { text: "Riesci a dire 'no' quando ti vengono chieste troppe cose?", options: [{ text: "No, mai", value: 1 }, { text: "Raramente, mi sento in colpa", value: 2 }, { text: "A volte, ma con difficoltà", value: 3 }, { text: "Sì, riesco a stabilire i miei limiti", value: 4 }] },
        { text: "Pensi in modo catastrofico, immaginando sempre il peggio?", options: [{ text: "Sì, è il mio modo di pensare abituale", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Come giudichi la tua capacità di gestire lo stress?", options: [{ text: "Molto bassa", value: 1 }, { text: "Bassa", value: 2 }, { text: "Discreta", value: 3 }, { text: "Buona", value: 4 }] },
        { text: "Ti senti disconnesso dagli altri o isolato?", options: [{ text: "Sì, molto spesso", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Hai perso interesse o piacere nelle attività che prima ti piacevano?", options: [{ text: "Sì, in quasi tutto", value: 1 }, { text: "In molte cose", value: 2 }, { text: "In alcune cose", value: 3 }, { text: "No, per niente", value: 4 }] },
    ],
    results: [
        { scoreMin: 20, scoreMax: 40, title: 'Livello di stress e ansia elevato', summary: 'I risultati indicano un livello significativo di stress e ansia. Potrebbe essere molto utile esplorare tecniche di gestione dello stress e, se necessario, consultare un professionista.' },
        { scoreMin: 41, scoreMax: 60, title: 'Livello di stress e ansia moderato', summary: 'Sperimenti periodi di stress e ansia che influenzano il tuo benessere. Imparare nuove strategie di coping potrebbe aiutarti a gestire meglio queste situazioni.' },
        { scoreMin: 61, scoreMax: 80, title: 'Buona gestione dello stress', summary: 'Sembra che tu abbia delle buone strategie per gestire lo stress e l\'ansia. Continua a prenderti cura del tuo benessere mentale e a coltivare le tue risorse.' },
    ],
  },
  diet: {
    id: 'diet',
    title: 'Analisi Dietetica',
    Icon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22c-3.3 0-6-2.7-6-6v-2a6 6 0 1 1 12 0v2c0 3.3-2.7 6-6 6z"/><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/><path d="M12 4V2"/><path d="M12 20v2"/><path d="m4.9 4.9 1.4 1.4"/><path d="m17.7 17.7 1.4 1.4"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m4.9 19.1 1.4-1.4"/><path d="m17.7 6.3 1.4-1.4"/></svg>,
    questions: [
        { text: "Quante porzioni di frutta e verdura consumi al giorno?", options: [{ text: "0-1", value: 1 }, { text: "2-3", value: 2 }, { text: "4-5", value: 3 }, { text: "Più di 5", value: 4 }] },
        { text: "Che tipo di carboidrati scegli prevalentemente?", options: [{ text: "Raffinati (pane bianco, pasta, riso bianco)", value: 1 }, { text: "Un mix di raffinati e integrali", value: 2 }, { text: "Prevalentemente integrali", value: 3 }, { text: "Integrali e legumi", value: 4 }] },
        { text: "Quante volte a settimana mangi pesce, specialmente quello azzurro?", options: [{ text: "Mai", value: 1 }, { text: "Meno di una volta", value: 2 }, { text: "1-2 volte", value: 4 }, { text: "Più di 2 volte", value: 3 }] },
        { text: "Qual è la tua principale fonte di proteine?", options: [{ text: "Carne rossa e processata", value: 1 }, { text: "Carne bianca e formaggi", value: 2 }, { text: "Un mix che include legumi e pesce", value: 3 }, { text: "Prevalentemente fonti vegetali (legumi, tofu)", value: 4 }] },
        { text: "Consumi bevande zuccherate (bibite, succhi di frutta confezionati)?", options: [{ text: "Ogni giorno", value: 1 }, { text: "Diverse volte a settimana", value: 2 }, { text: "Raramente", value: 3 }, { text: "Mai", value: 4 }] },
        { text: "Quanti caffè bevi al giorno?", options: [{ text: "Più di 4", value: 1 }, { text: "3-4", value: 2 }, { text: "1-2", value: 3 }, { text: "Nessuno o decaffeinato", value: 4 }] },
        { text: "Fai regolarmente colazione?", options: [{ text: "No, mai", value: 1 }, { text: "A volte", value: 2 }, { text: "Sì, ma con prodotti confezionati/zuccherati", value: 3 }, { text: "Sì, una colazione equilibrata", value: 4 }] },
        { text: "Consumi cibi fritti o molto processati (fast food, snack confezionati)?", options: [{ text: "Spesso, più volte a settimana", value: 1 }, { text: "Circa una volta a settimana", value: 2 }, { text: "Un paio di volte al mese", value: 3 }, { text: "Molto raramente o mai", value: 4 }] },
        { text: "Quanta acqua bevi al giorno?", options: [{ text: "Meno di 1 litro", value: 1 }, { text: "Circa 1 litro", value: 2 }, { text: "1.5 - 2 litri", value: 3 }, { text: "Più di 2 litri", value: 4 }] },
        { text: "Soffri di gonfiore, pesantezza o altri disturbi digestivi dopo i pasti?", options: [{ text: "Sì, molto spesso", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente", value: 4 }] },
        { text: "Quante volte a settimana consumi legumi (fagioli, lenticchie, ceci)?", options: [{ text: "Mai", value: 1 }, { text: "Meno di una volta", value: 2 }, { text: "1-2 volte", value: 3 }, { text: "3 o più volte", value: 4 }] },
        { text: "Che tipo di grassi usi per cucinare?", options: [{ text: "Burro, margarina, strutto", value: 1 }, { text: "Oli di semi vari (girasole, mais)", value: 2 }, { text: "Principalmente olio extra vergine d'oliva", value: 4 }, { text: "Un mix, con prevalenza di olio EVO", value: 3 }] },
        { text: "Leggi le etichette nutrizionali dei prodotti che acquisti?", options: [{ text: "No, mai", value: 1 }, { text: "Raramente", value: 2 }, { text: "A volte, per alcuni prodotti", value: 3 }, { text: "Sì, quasi sempre", value: 4 }] },
        { text: "I tuoi pasti sono regolari o tendi a saltarli?", options: [{ text: "Spesso salto i pasti", value: 1 }, { text: "A volte ne salto uno", value: 2 }, { text: "Cerco di essere regolare", value: 3 }, { text: "Ho orari molto regolari", value: 4 }] },
        { text: "Mangi di fretta, magari in piedi o davanti a uno schermo?", options: [{ text: "Sì, quasi sempre", value: 1 }, { text: "Spesso", value: 2 }, { text: "A volte", value: 3 }, { text: "Raramente, mi prendo il mio tempo", value: 4 }] },
        { text: "Consumi dolci, torte o biscotti?", options: [{ text: "Ogni giorno", value: 1 }, { text: "Diverse volte a settimana", value: 2 }, { text: "Solo nel weekend o in occasioni speciali", value: 3 }, { text: "Molto raramente", value: 4 }] },
        { text: "Includi frutta secca e semi nella tua dieta?", options: [{ text: "No, mai", value: 1 }, { text: "Raramente", value: 2 }, { text: "Qualche volta a settimana", value: 3 }, { text: "Sì, una piccola porzione quasi ogni giorno", value: 4 }] },
        { text: "Quante volte a settimana mangi carne rossa?", options: [{ text: "Più di 3 volte", value: 1 }, { text: "2-3 volte", value: 2 }, { text: "Una volta", value: 3 }, { text: "Raramente o mai", value: 4 }] },
        { text: "Assumi integratori alimentari?", options: [{ text: "Sì, diversi e senza consulto medico", value: 1 }, { text: "Sì, su consiglio del medico/farmacista", value: 4 }, { text: "A volte, quando mi sento stanco", value: 2 }, { text: "No, mai", value: 3 }] },
        { text: "Come descriveresti la tua dieta nel complesso?", options: [{ text: "Poco sana e sbilanciata", value: 1 }, { text: "Potrebbe essere molto migliore", value: 2 }, { text: "Abbastanza sana ed equilibrata", value: 3 }, { text: "Molto sana e varia", value: 4 }] },
    ],
    results: [
        { scoreMin: 20, scoreMax: 40, title: 'Abitudini alimentari da rivedere', summary: 'La tua dieta attuale presenta diverse aree di miglioramento. Potrebbe essere utile concentrarsi sull\'introduzione di cibi più freschi e nutrienti e sulla riduzione di quelli processati.' },
        { scoreMin: 41, scoreMax: 60, title: 'Abitudini alimentari discrete', summary: 'Hai una buona base, ma ci sono alcuni aspetti della tua alimentazione che, se modificati, potrebbero portare a un maggiore benessere generale.' },
        { scoreMin: 61, scoreMax: 80, title: 'Buone abitudini alimentari', summary: 'Segui una dieta generalmente sana ed equilibrata. Continua a fare scelte consapevoli per mantenere il tuo stato di salute ottimale.' },
    ],
  },
  microbiome: {
    id: 'microbiome',
    title: 'Analisi del Microbioma',
    Icon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22c-3.3 0-6-2.7-6-6v-2a6 6 0 1 1 12 0v2c0 3.3-2.7 6-6 6z"/><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/><path d="M12 4V2"/><path d="M12 20v2"/><path d="m4.9 4.9 1.4 1.4"/><path d="m17.7 17.7 1.4 1.4"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m4.9 19.1 1.4-1.4"/><path d="m17.7 6.3 1.4-1.4"/></svg>,
    questions: [
        { text: "Quanta fibra assumi giornalmente (da frutta, verdura, legumi, cereali integrali)?", options: [{ text: "Molto poca", value: 1 }, { text: "Una quantità moderata", value: 2 }, { text: "Una buona quantità", value: 3 }, { text: "Molta, ad ogni pasto", value: 4 }] },
        { text: "Consumi cibi fermentati (yogurt con fermenti vivi, kefir, crauti, kombucha)?", options: [{ text: "Mai", value: 1 }, { text: "Raramente", value: 2 }, { text: "Qualche volta a settimana", value: 3 }, { text: "Quasi ogni giorno", value: 4 }] },
        { text: "La tua dieta è varia o tendi a mangiare sempre le stesse cose?", options: [{ text: "Mangio sempre le stesse cose", value: 1 }, { text: "Poco varia", value: 2 }, { text: "Abbastanza varia", value: 3 }, { text: "Molto varia, provo spesso nuovi alimenti", value: 4 }] },
        { text: "Hai fatto uso di antibiotici negli ultimi 6 mesi?", options: [{ text: "Sì, per un lungo periodo o più cicli", value: 1 }, { text: "Sì, un ciclo breve", value: 2 }, { text: "No", value: 4 }, { text: "Non ricordo", value: 3 }] },
        { text: "La tua regolarità intestinale è:", options: [{ text: "Molto irregolare (stitichezza o diarrea frequenti)", value: 1 }, { text: "A volte irregolare", value: 2 }, { text: "Generalmente regolare", value: 3 }, { text: "Molto regolare", value: 4 }] },
        { text: "Soffri di intolleranze o sensibilità alimentari (glutine, lattosio, ecc.)?", options: [{ text: "Sì, a diversi alimenti", value: 1 }, { text: "Sì, a uno o due alimenti", value: 2 }, { text: "Sospetto di averne, ma non ho diagnosi", value: 3 }, { text: "No, che io sappia", value: 4 }] },
        { text: "Consumi dolcificanti artificiali (aspartame, sucralosio)?", options: [{ text: "Sì, quotidianamente", value: 1 }, { text: "Spesso", value: 2 }, { text: "Raramente", value: 3 }, { text: "Mai", value: 4 }] },
        { text: "Includi nella tua dieta polifenoli (presenti in tè verde, caffè, cioccolato fondente, frutti di bosco)?", options: [{ text: "Raramente o mai", value: 1 }, { text: "A volte", value: 2 }, { text: "Spesso", value: 3 }, { text: "Sì, regolarmente", value: 4 }] },
        { text: "Il tuo livello di stress quotidiano è:", options: [{ text: "Molto alto", value: 1 }, { text: "Alto", value: 2 }, { text: "Moderato", value: 3 }, { text: "Basso", value: 4 }] },
        { text: "Passi del tempo all'aria aperta o a contatto con la natura?", options: [{ text: "Molto raramente", value: 1 }, { text: "A volte, nel weekend", value: 2 }, { text: "Abbastanza spesso", value: 3 }, { text: "Sì, quotidianamente", value: 4 }] },
        { text: "Consumi aglio, cipolle, porri o asparagi (fonti di prebiotici)?", options: [{ text: "Mai o quasi mai", value: 1 }, { text: "Raramente", value: 2 }, { text: "Qualche volta a settimana", value: 3 }, { text: "Spesso", value: 4 }] },
        { text: "Hai animali domestici in casa?", options: [{ text: "Sì", value: 4 }, { text: "No", value: 2 }, { text: "Ne ho avuti in passato", value: 3 }, { text: "Non risponde", value: 1 }] },
        { text: "La tua nascita è avvenuta con parto naturale o cesareo?", options: [{ text: "Cesareo", value: 2 }, { text: "Naturale", value: 4 }, { text: "Non lo so", value: 3 }, { text: "Non risponde", value: 1 }] },
        { text: "Sei stato allattato al seno da bambino?", options: [{ text: "No", value: 2 }, { text: "Sì, per alcuni mesi", value: 3 }, { text: "Sì, per più di 6 mesi", value: 4 }, { text: "Non lo so", value: 1 }] },
        { text: "Soffri di malattie infiammatorie croniche intestinali (es. Crohn, colite ulcerosa) o sindrome dell'intestino irritabile (IBS)?", options: [{ text: "Sì, ho una diagnosi", value: 1 }, { text: "Ho sintomi ma nessuna diagnosi", value: 2 }, { text: "No", value: 4 }, { text: "Non risponde", value: 3 }] },
        { text: "Fumi?", options: [{ text: "Sì, regolarmente", value: 1 }, { text: "Occasionalmente", value: 2 }, { text: "Ho smesso da poco", value: 3 }, { text: "No, non fumo", value: 4 }] },
        { text: "Bevi alcolici?", options: [{ text: "Ogni giorno", value: 1 }, { text: "Diverse volte a settimana", value: 2 }, { text: "Solo occasionalmente (es. nel weekend)", value: 3 }, { text: "Molto raramente o mai", value: 4 }] },
        { text: "Dormi un numero sufficiente di ore per notte?", options: [{ text: "No, dormo poco e male", value: 1 }, { text: "A volte non abbastanza", value: 2 }, { text: "Generalmente sì", value: 3 }, { text: "Sì, dormo bene e a sufficienza", value: 4 }] },
        { text: "Fai attività fisica regolarmente?", options: [{ text: "No, sono sedentario", value: 1 }, { text: "Raramente", value: 2 }, { text: "Qualche volta a settimana", value: 3 }, { text: "Sì, regolarmente", value: 4 }] },
        { text: "Soffri di allergie o malattie autoimmuni?", options: [{ text: "Sì, più di una", value: 1 }, { text: "Sì, una", value: 2 }, { text: "No", value: 4 }, { text: "Non che io sappia", value: 3 }] },
    ],
    results: [
        { scoreMin: 20, scoreMax: 40, title: 'Microbioma potenzialmente in disbiosi', summary: 'Diversi fattori nel tuo stile di vita potrebbero non supportare un microbioma sano. Potrebbe essere utile concentrarsi su una dieta più varia e ricca di fibre e prebiotici.' },
        { scoreMin: 41, scoreMax: 60, title: 'Equilibrio del microbioma migliorabile', summary: 'Ci sono buone basi, ma alcuni aspetti possono essere ottimizzati per favorire ulteriormente la salute del tuo intestino e, di conseguenza, di tutto l\'organismo.' },
        { scoreMin: 61, scoreMax: 80, title: 'Buon supporto al microbioma', summary: 'Il tuo stile di vita sembra essere generalmente favorevole a un microbioma sano ed equilibrato. Continua a prenderti cura del tuo intestino con scelte alimentari consapevoli.' },
    ],
  },
};

const wellnessData = {
    programs: [
        { name: "Stress Management", duration: "60 min", price: 60, package4: 215, description: "Programma integrato per la gestione dello stress e il riequilibrio psicofisico." },
        { name: "Sleep Program", duration: "60 min", price: 60, package4: 215, description: "Un percorso mirato a migliorare la qualità del sonno e favorire il rilassamento profondo." },
        { name: "Performance Program", duration: "60 min", price: 60, package4: 215, description: "Ideato per ottimizzare le energie e migliorare le capacità fisiche e mentali." },
        { name: "Longevity Program", duration: "1h 15 min", price: 80, package4: 290, description: "Percorso orientato alla prevenzione e al mantenimento della vitalità nel tempo." },
        { name: "Wellness Program", duration: "60 min", price: 60, package4: 215, description: "Programma completo per raggiungere uno stato di benessere generale e rigenerazione." },
    ],
    treatments: [
        {
            category: "Massaggi",
            items: [
                { name: "Massaggio Linfodrenante", duration: "50 min", price: 50, package4: 180 },
                { name: "Massaggio Connettivale", duration: "50 min", price: 50, package4: 180, package6: 270, package10: 450 },
                { name: "Massaggio Tuina", duration: "50 min", price: 50, package4: 180 },
                { name: "Massaggio Antistress", duration: "1h 15 min", price: 80, package4: 290 },
                { name: "Massaggio Bioenergetico", duration: "1h 15 min", price: 80, package4: 290 },
                { name: "Riflessologia Plantare", duration: "50 min", price: 50, package4: 180 },
                { name: "Massaggio con Coppettazione", duration: "50 min", price: 50, package4: 180 },
                { name: "Massaggio Relax", duration: "60 min", price: 60, package4: 215 },
            ]
        },
        {
            category: "Trattamenti Anti-Cellulite",
            items: [
                { name: "Connettivale base", duration: "50 min", price: 50, package6: 270, package10: 450 },
                { name: "Connettivale con prodotti specifici", duration: "50 min", price: 55, package6: 300, package10: 490 },
                { name: "Sauna Infrarossi + Connettivale", duration: "60 min", price: 55, package6: 300, package10: 490 },
                { name: "Connettivale + Termosauna", duration: "60 min", price: 60, package6: 330, package10: 540 },
                { name: "Ionoforesi + Connettivale", duration: "60 min", price: 60, package6: 330, package10: 540 },
            ]
        },
        {
            category: "Trattamenti Corpo",
            items: [
                { name: "Termosauna", duration: "30 min", price: 30 },
                { name: "Peeling corpo (Sauna + Peeling)", duration: "60 min", price: 50 },
            ]
        },
        {
            category: "Trattamenti Viso RENOPHASE®",
            items: [
                { name: "Igiene Viso 1", duration: "50 min", price: 90 },
                { name: "Igiene Viso 2 (pelle grassa)", duration: "50 min", price: 120 },
                { name: "Anti-Age base", duration: "50 min", price: 60 },
                { name: "Anti-Age RENOPHASE", duration: "50 min", price: 120 },
                { name: "Pelli Sensibili base", duration: "50 min", price: 60 },
                { name: "Pelli Sensibili RENOPHASE", duration: "50 min", price: 90 },
                { name: "Pelli Secche base", duration: "50 min", price: 60 },
                { name: "Soft RENOPHASE", duration: "50 min", price: 90 },
                { name: "Intensivo RENOPHASE", duration: "50 min", price: 150 },
                { name: "Macchie RENOPHASE", duration: "50 min", price: 150 },
                { name: "Acne RENOPHASE", duration: "50 min", price: 150 },
                { name: "Pre/Post Iniettivi RENOPHASE", duration: "50 min", price: 150 },
            ]
        },
        {
            category: "Trattamenti Microaree RENOPHASE®",
            items: [
                { name: "Occhi", baseDuration: "45 min", basePrice: 60, photoDuration: "60 min", photoPrice: 80 },
                { name: "Collo", baseDuration: "45 min", basePrice: 60, photoDuration: "60 min", photoPrice: 80 },
                { name: "Labbra", baseDuration: "45 min", basePrice: 60, photoDuration: "60 min", photoPrice: 80 },
            ]
        },
        {
            category: "Mantenimento e Prevenzione",
            items: [
                { name: "Fotostimolazione LED", duration: "30 min", price: 40, package6: 219 },
            ]
        },
        {
            category: "Trattamenti Specifici",
            items: [
                { name: "Gambe Pesanti: Linfodrenante + Impedenzometria", duration: "60 min", package10: 470 },
                { name: "Gambe Pesanti: Linfodrenante + Bendaggi Freddi", duration: "60 min", price: 60, package6: 330 },
                { name: "Gonfiore Addominale: Sauna Finlandese + Udara", duration: "60 min", price: 60, package6: 330 },
            ]
        },
    ]
};

const wellnessProgramsData = {
    start: {
        id: 'start',
        name: '🌟 Programma Start: Routine del Benessere',
        subtitle: '💥 La Settimana del Successo',
        description: 'Completa le attività giornaliere e settimanali per costruire abitudini sane e accumulare punti.',
        Icon: '✨',
        numWeeks: 10,
        daily: [
            { id: 'start_d_new_0', title: 'Meditare regolarmente', Icon: '🧘', description: '15–20 minuti prima di dormire.', points: 5, remindable: true, reminderConfig: { type: 'daily', time: '22:00' } },
            { id: 'start_d_new_1', title: 'Orari regolari (mattina)', Icon: '⏰', description: 'Sveglia costante.', points: 5 },
            { id: 'start_d_new_2', title: 'Orari regolari (sera)', Icon: '⏰', description: 'Orario fisso per dormire.', points: 5 },
            { id: 'start_d_new_3', title: 'Stretching o movimento', Icon: '🤸', description: 'Durante la giornata.', points: 5 },
            { id: 'start_d_new_4', title: 'Evitare caffeina', Icon: '☕🚫', description: 'Nel pomeriggio e sera.', points: 5 },
            { id: 'start_d_new_5', title: 'Evitare alcol', Icon: '🍷🚫', description: 'Nel pomeriggio e sera.', points: 5 },
            { id: 'start_d_new_6', title: 'Rilassamento muscolare', Icon: '🛌', description: 'Prima di dormire.', points: 5 },
            { id: 'start_d_new_7', title: 'Spegnere dispositivi', Icon: '📵', description: 'Almeno 1h prima di dormire.', points: 5 },
            { id: 'start_d_new_8', title: 'Leggere un libro', Icon: '📖', description: 'Attività serale.', points: 5 },
            { id: 'start_d_new_9', title: 'Bagno caldo', Icon: '🛁', description: 'Relax serale.', points: 5 },
            { id: 'start_d_new_10', title: 'Tracciare abitudini', Icon: '📝', description: 'Diario del sonno.', points: 5 },
            { id: 'start_d_new_11', title: 'Terapia binaurale', Icon: '🎧', description: 'Onde Alpha/Delta.', points: 5 },
            { id: 'start_d_new_12', title: 'Fitoterapia', Icon: '🌿', description: 'Se indicata.', points: 5 },
            { id: 'start_d_new_13', title: 'Idratazione', Icon: '💧', description: '8 bicchieri d’acqua.', points: 5, remindable: true, reminderConfig: { type: 'interval', hours: 2, startHour: 9, endHour: 19 } },
            { id: 'start_d_new_14', title: 'Oli essenziali', Icon: '🌸', description: 'Relax serale.', points: 5 },
            { id: 'start_d_new_15', title: 'Autocompassione', Icon: '💕', description: 'Gentilezza verso sé.', points: 5 },
            { id: 'start_d_new_16', title: 'Passeggiata all’aperto', Icon: '🚶', description: '10–20 minuti.', points: 5 },
            { id: 'start_d_new_17', title: 'Gratitudine', Icon: '🙏', description: 'Esercizi positivi.', points: 5 },
            { id: 'start_d_new_18', title: 'Musica rilassante', Icon: '🎵', description: 'Ascolto consapevole.', points: 5 },
            { id: 'start_d_new_19', title: 'Creatività', Icon: '🎨', description: 'Disegno, scrittura, ecc.', points: 5 },
            { id: 'start_d_new_20', title: 'Limitare social media', Icon: '📱🚫', description: '<30 min al giorno.', points: 5 },
            { id: 'start_d_new_21', title: 'Pianificare pasti', Icon: '📅', description: 'Organizzazione settimanale.', points: 5 },
            { id: 'start_d_new_22', title: 'Verdure a foglia verde', Icon: '🥬', description: 'Almeno una porzione.', points: 5 },
            { id: 'start_d_new_23', title: 'Detox digitale', Icon: '📴', description: '1 giorno senza schermi.', points: 10 },
            { id: 'start_d_new_24', title: 'Meditazione serale (ripetuta)', Icon: '🧘', description: 'Seconda sessione.', points: 5 }
        ],
        weekly: [
            { id: 'start_w_s3_1', title: 'Weekend con alimentazione salutare', description: 'Frutta, verdura, omega-3, proteine magre per almeno 2 giorni.', points: 30, Icon: '🥗' },
            { id: 'start_w_s3_2', title: 'Terapia Cranio-Sacrale', description: '1 sessione settimanale per rilassare il sistema nervoso.', points: 25, Icon: '💆‍♂️' },
            { id: 'start_w_s3_3', title: 'Cibi ricchi di omega-3', description: 'Almeno 3 volte a settimana (es. salmone, noci, semi di lino).', points: 15, Icon: '🐟' },
            { id: 'start_w_s3_4', title: 'Settimana senza Alcol', description: 'Evita completamente il consumo di alcolici per 7 giorni.', points: 20, Icon: '🍷🚫' },
            { id: 'start_w_s3_5', title: 'Meal Prep', description: 'Prepara i pasti in lotti per la settimana.', points: 10, Icon: '🍱' },
            { id: 'start_w_s3_6', title: 'Yoga o Pilates', description: 'Partecipa ad almeno 1 sessione settimanale.', points: 20, Icon: '🧘‍♀️' },
            { id: 'start_w_s3_7', title: 'Sauna infrarossi', description: '1 sessione per rilassare corpo e mente.', points: 30, Icon: '🔥' },
            { id: 'start_w_s3_8', title: 'Zona 2 – Attività fisica', description: '2 sessioni di movimento aerobico a bassa intensità.', points: 80, Icon: '🏃' },
            { id: 'start_w_s3_9', title: 'Tisana Detox', description: 'Bevi almeno 3 tisane depurative durante la settimana.', points: 20, Icon: '🍵' },
            { id: 'start_w_s3_10', title: 'Terapia binaurale/mindfulness', description: '2 sessioni di ascolto consapevole o meditazione guidata.', points: 40, Icon: '🎧' },
            { id: 'start_w_s3_11', title: 'Massaggio rilassante', description: '1 sessione settimanale per sciogliere tensioni muscolari.', points: 50, Icon: '💆' },
            { id: 'start_w_s3_12', title: 'Biofeedback', description: '1 sessione con coerenza cardiaca.', points: 30, Icon: '❤️' },
            { id: 'start_w_s3_13', title: 'Stimolazione Nervo Vago', description: 'Tecnica di rilassamento vagale (es. vocalizzi, respirazione lenta).', points: 30, Icon: '⚡' },
            { id: 'start_w_s3_14', title: 'Programma combinato', description: 'Sauna + massaggio + terapia binaurale + fitoterapia in un’unica sessione.', points: 150, Icon: '🧖‍♂️' }
        ]
    },
    food_level_1: {
        id: 'food_level_1',
        name: 'Missione Alimentare: Livello 1',
        subtitle: 'La Festa dei Sapori',
        description: 'Migliora le tue abitudini con queste missioni giornaliere e settimanali.',
        Icon: '🍽️',
        dailyTarget: 35,
        numWeeks: 10,
        daily: [
            { id: 'food1_d_1', title: 'Riduzione dello Zucchero (1 giorno)', Icon: '🍭', description: 'Evita dolci e bevande zuccherate per tutta la giornata.', points: 10 },
            { id: 'food1_d_2', title: 'Introduzione dei Legumi', Icon: '🌱', description: 'Integra legumi in almeno un pasto del giorno.', points: 10 },
            { id: 'food1_d_3', title: 'Colazione Equilibrata', Icon: '🍳', description: 'Yogurt greco, frutta fresca, granola integrale. Bevanda: tè verde.', points: 5 },
            { id: 'food1_d_4', title: 'Smoothie Detox', Icon: '🍹', description: 'Spinaci, banana, ananas, semi di chia. Bevanda: acqua di cocco.', points: 5 },
            { id: 'food1_d_5', title: 'Spuntino Sano', Icon: '🥕', description: 'Carote e sedano con guacamole. Bevanda: tisana al finocchio.', points: 5 },
            { id: 'food1_d_6', title: 'Cena Light', Icon: '🌙', description: 'Pesce al vapore, patate dolci, asparagi. Bevanda: tè alla menta.', points: 10 },
            { id: 'food1_d_7', title: 'Insalata Proteica', Icon: '🥗', description: 'Pollo grigliato, avocado, pomodorini, semi di zucca. Bevanda: infuso ai frutti di bosco.', points: 10 }
        ],
        weekly: [
            { id: 'food1_w_1', title: '🍭 Riduzione dello Zucchero', description: 'Evitare bevande zuccherate e dolci in almeno due pasti.', points: 20, Icon: '🍭' },
            { id: 'food1_w_2', title: '🌱 Introduzione dei Legumi', description: 'Integrare lenticchie, fagioli o ceci in almeno tre pasti.', points: 30, Icon: '🌱' },
            { id: 'food1_w_3', title: '🍞 Cottura al Forno', description: 'Sostituire cibi fritti con cottura al forno.', points: 20, Icon: '🍞' },
            { id: 'food1_w_4', title: '🍇 Snack Sani', description: 'Frutta secca, noci e semi al posto di snack industriali.', points: 20, Icon: '🍇' },
            { id: 'food1_w_5', title: '🍽️ Pasti Bilanciati', description: 'Proteine magre, carboidrati complessi e verdure colorate.', points: 30, Icon: '🍽️' },
            { id: 'food1_w_6', title: '🍳 Colazione Equilibrata', description: 'Yogurt greco, frutta fresca, granola integrale. Bevanda: tè verde.', points: 20, Icon: '🍳' },
            { id: 'food1_w_7', title: '🥗 Pranzo Vegetariano', description: 'Insalata di quinoa, verdure grigliate, hummus. Bevanda: acqua al limone.', points: 30, Icon: '🥗' },
            { id: 'food1_w_8', title: '🍹 Smoothie Detox', description: 'Spinaci, banana, ananas, semi di chia. Bevanda: acqua di cocco.', points: 10, Icon: '🍹' },
            { id: 'food1_w_9', title: '🥕 Spuntino Sano', description: 'Carote e sedano con guacamole. Bevanda: tisana al finocchio.', points: 10, Icon: '🥕' },
            { id: 'food1_w_10', title: '🌙 Cena Light', description: 'Pesce al vapore, patate dolci, asparagi. Bevanda: tè alla menta.', points: 30, Icon: '🌙' },
            { id: 'food1_w_11', title: '🥗 Insalata Proteica', description: 'Pollo grigliato, avocado, pomodorini, semi di zucca. Bevanda: infuso ai frutti di bosco.', points: 30, Icon: '🥗' },
            { id: 'food1_w_12', title: '🍎 Giornata di Frutta', description: 'Solo frutta fresca (mele, pere, fragole, uva). Bevanda: smoothie di frutta mista.', points: 30, Icon: '🍎' }
        ]
    },
    food_level_2: {
        id: 'food_level_2',
        name: 'Missione Alimentare: Livello 2',
        subtitle: 'Energia in Cucina',
        description: 'Potenzia le tue abitudini con queste missioni giornaliere.',
        Icon: '🍳',
        dailyTarget: 35,
        unlocksAt: 1500,
        dependsOn: 'food_level_1',
        daily: [
            { id: 'food2_d_1', title: 'Riduzione dello Zucchero (2 giorni)', Icon: '🍭', description: 'Evita dolci e bevande zuccherate per almeno 2 giorni.', points: 10 },
            { id: 'food2_d_2', title: 'Introduzione dei Legumi (2 pasti)', Icon: '🌱', description: 'Integra legumi in almeno due pasti.', points: 10 },
            { id: 'food2_d_3', title: 'Colazione Equilibrata (2 volte)', Icon: '🍳', description: 'Yogurt, frutta, granola. Bevanda: tè verde.', points: 5 },
            { id: 'food2_d_4', title: 'Smoothie Detox (2 volte)', Icon: '🍹', description: 'Spinaci, banana, ananas, semi di chia.', points: 5 },
            { id: 'food2_d_5', title: 'Spuntino Sano', Icon: '🥕', description: 'Carote e sedano con guacamole.', points: 5 },
            { id: 'food2_d_6', title: 'Cena Light', Icon: '🌙', description: 'Pesce al vapore, patate dolci, asparagi.', points: 10 },
            { id: 'food2_d_7', title: 'Cottura al Forno', Icon: '🍞', description: 'Sostituisci frittura con cottura al forno.', points: 10 },
            { id: 'food2_d_8', title: 'Snack Sani', Icon: '🍇', description: 'Frutta secca, noci, semi.', points: 10 }
        ],
        weekly: []
    },
    food_level_3: {
        id: 'food_level_3',
        name: 'Missione Alimentare: Livello 3',
        subtitle: 'Sfida del Gourmet',
        description: 'Diventa un maestro della nutrizione con missioni avanzate.',
        Icon: '🍲',
        dailyTarget: 35,
        unlocksAt: 1500,
        dependsOn: 'food_level_2',
        daily: [
            { id: 'food3_d_1', title: 'Riduzione dello Zucchero (5 giorni)', Icon: '🍭', description: 'Evita dolci e bevande zuccherate per almeno 5 giorni a settimana.', points: 10 },
            { id: 'food3_d_2', title: 'Introduzione dei Legumi (2 pasti)', Icon: '🌱', description: 'Integra legumi in almeno due pasti.', points: 10 },
            { id: 'food3_d_3', title: 'Colazione Equilibrata (4 volte)', Icon: '🍳', description: 'Yogurt, frutta, granola. Bevanda: tè verde.', points: 5 },
            { id: 'food3_d_4', title: 'Smoothie Detox (4 volte)', Icon: '🍹', description: 'Spinaci, banana, ananas, semi di chia.', points: 5 },
            { id: 'food3_d_5', title: 'Spuntino Sano', Icon: '🥕', description: 'Carote e sedano con guacamole.', points: 5 },
            { id: 'food3_d_6', title: 'Cena Light', Icon: '🌙', description: 'Pesce al vapore, patate dolci, asparagi.', points: 10 },
            { id: 'food3_d_7', title: 'Cottura al Forno', Icon: '🍞', description: 'Sostituisci frittura con cottura al forno.', points: 10 },
            { id: 'food3_d_8', title: 'Snack Sani (4 volte)', Icon: '🍇', description: 'Frutta secca, noci, semi almeno 4 volte a settimana.', points: 10 },
            { id: 'food3_d_9', title: 'Pasti Bilanciati (4 volte)', Icon: '🍽️', description: 'Proteine magre, carboidrati complessi, verdure colorate.', points: 10 },
            { id: 'food3_d_10', title: 'Colazione Equilibrata (2 volte)', Icon: '🍳', description: 'Seconda sessione settimanale di colazione equilibrata.', points: 5 },
            { id: 'food3_d_11', title: 'Pranzo Vegetariano (4 volte)', Icon: '🥗', description: 'Quinoa, verdure grigliate, hummus. Bevanda: acqua aromatizzata.', points: 10 }
        ],
        weekly: []
    },
    sleep_level_1: {
        id: 'sleep_level_1',
        name: 'Missione Sonno Giornaliera: Livello 1',
        subtitle: 'Alba Tranquilla',
        description: 'Include tutte le Attività Giornaliere di base come mantenere orari regolari di sonno e praticare la respirazione profonda prima di dormire.',
        Icon: '🌅',
        numWeeks: 10,
        dailyTarget: 35,
        dailyMaxTarget: 60,
        weekly: [],
        daily: [
            { id: 'sl1_d_1', title: 'Orari Regolari di Sonno', Icon: '⏰', description: 'Andare a letto e svegliarsi alla stessa ora ogni giorno.', points: 10 },
            { id: 'sl1_d_2', title: 'Respirazione Profonda', Icon: '🌬️', description: 'Pratica di 10–15 minuti prima di dormire.', points: 10 },
            { id: 'sl1_d_3', title: 'No Dispositivi Elettronici', Icon: '📵', description: 'Evita schermi almeno 1 ora prima di dormire.', points: 10 },
            { id: 'sl1_d_4', title: 'Fitoterapici (fase 1)', Icon: '🌿', description: 'Assunzione di rimedi naturali se indicati.', points: 15 },
            { id: 'sl1_d_5', title: 'Rilassamento Muscolare', Icon: '🛌', description: 'Esercizi di rilassamento per 10–15 minuti.', points: 10 },
            { id: 'sl1_d_6', title: 'No Caffeina', Icon: '☕🚫', description: 'Evita caffè e tè nel pomeriggio e sera.', points: 10 }
        ]
    },
    sleep_level_2: {
        id: 'sleep_level_2',
        name: 'Missione Sonno Giornaliera: Livello 2',
        subtitle: 'Sogno Calmo',
        description: 'Attività focalizzate sul rilassamento profondo per migliorare la qualità del riposo notturno.',
        Icon: '🌠',
        numWeeks: 10,
        dailyTarget: 40,
        dailyMaxTarget: 60,
        unlocksAt: 1500,
        dependsOn: 'sleep_level_1',
        weekly: [],
        daily: [
            { id: 'sl2_d_1', title: 'Rilassamento Muscolare Progressivo', Icon: '🛌', description: '20 minuti di rilascio graduale della tensione muscolare.', points: 15 },
            { id: 'sl2_d_2', title: 'Musica Rilassante', Icon: '🎵', description: 'Ascolta musica tranquilla per 20–30 minuti prima di dormire.', points: 10 },
            { id: 'sl2_d_3', title: 'Fitoterapici (fase 2)', Icon: '🌿', description: 'Assunzione di rimedi naturali se indicati per la fase 2 del sonno.', points: 15 },
            { id: 'sl2_d_4', title: 'Visualizzazione Tranquilla', Icon: '🌅', description: 'Immagina un luogo sereno per 10–15 minuti.', points: 15 },
            { id: 'sl2_d_5', title: 'Bagno Caldo Serale', Icon: '🛁', description: '30 minuti di bagno rilassante prima di dormire.', points: 10 }
        ]
    },
    sleep_level_3: {
        id: 'sleep_level_3',
        name: 'Missione Sonno Giornaliera: Livello 3',
        subtitle: 'Notte Magica',
        description: 'Include tutte le Attività giornaliere avanzate quali meditazione profonda e tecniche di rilassamento per un riposo ottimale.',
        Icon: '🌌',
        numWeeks: 10,
        dailyTarget: 45,
        dailyMaxTarget: 60,
        unlocksAt: 2500,
        dependsOn: 'sleep_level_2',
        weekly: [],
        daily: [
            { id: 'sl3_d_1', title: 'Meditazione Guidata per il Sonno', Icon: '🎧', description: '20 minuti di meditazione profonda per favorire il rilassamento.', points: 20 },
            { id: 'sl3_d_2', title: 'Mindfulness Serale', Icon: '🧘', description: '20 minuti di consapevolezza prima di dormire.', points: 15 },
            { id: 'sl3_d_3', title: 'Fitoterapici (fasi 3–4)', Icon: '🌿', description: 'Rimedi naturali per il sonno profondo, se indicati.', points: 15 },
            { id: 'sl3_d_4', title: 'Oli Essenziali di Lavanda', Icon: '🌸', description: '20 minuti di aromaterapia rilassante.', points: 15 },
            { id: 'sl3_d_5', title: 'Stretching Leggero', Icon: '🤸', description: '20 minuti di esercizi dolci prima di coricarsi.', points: 15 },
            { id: 'sl3_d_6', title: 'Visualizzazione Positiva', Icon: '🌅', description: '10 minuti di immagini mentali serene e rassicuranti.', points: 15 }
        ]
    },
    sleep_level_4: {
        id: 'sleep_level_4',
        name: 'Missione Sonno Giornaliera: Livello 4',
        subtitle: 'Sonno Profondo',
        description: 'Include tutte le Attività giornaliere con tecniche avanzate di gestione del sonno come l\'utilizzo di fitoterapici e routine di rilassamento complesse per garantire un sonno ristoratore.',
        Icon: '🌙',
        numWeeks: 10,
        dailyTarget: 55,
        dailyMaxTarget: 70,
        unlocksAt: 3500,
        dependsOn: 'sleep_level_3',
        weekly: [],
        daily: [
            { id: 'sl4_d_1', title: 'Diario del Sonno', Icon: '📓', description: 'Monitoraggio quotidiano delle abitudini di sonno.', points: 15 },
            { id: 'sl4_d_2', title: 'Fitoterapici (fase REM)', Icon: '🌿', description: 'Rimedi naturali per migliorare la fase REM, se indicati.', points: 15 },
            { id: 'sl4_d_3', title: 'Yoga Rilassante', Icon: '🧘‍♂️', description: '30 minuti di yoga dolce prima di dormire.', points: 20 },
            { id: 'sl4_d_4', title: 'Rilassamento Profondo', Icon: '🛌', description: '20 minuti di tecniche avanzate di rilassamento.', points: 20 },
            { id: 'sl4_d_5', title: 'Gestione del Tempo', Icon: '⏳', description: 'Tecniche per ridurre lo stress quotidiano e migliorare la routine serale.', points: 15 },
            { id: 'sl4_d_6', title: 'Attività Rilassanti Serali', Icon: '📚', description: 'Lettura, scrittura o attività creative prima di dormire.', points: 15 }
        ]
    },
    anxiety_stress_level_1: {
        id: 'anxiety_stress_level_1',
        name: 'Programma Ansia-Stress: Livello 1',
        subtitle: 'Il Giardino della Serenità',
        description: 'Include tutte le Attività Settimanali per ridurre Ansia e Stress.',
        Icon: '🌿',
        weeklyMinTarget: 200,
        numWeeks: 14,
        daily: [],
        weekly: [
            { id: 'anxiety1_w_1', title: 'Respirazione Profonda', Icon: '🌬️', description: '10–15 minuti di respirazione lenta e consapevole.', points: 10 },
            { id: 'anxiety1_w_2', title: 'Visualizzazione Rilassante', Icon: '🌅', description: 'Immagina un luogo sereno per 10–15 minuti.', points: 10 },
            { id: 'anxiety1_w_3', title: 'Camminata Consapevole', Icon: '🚶', description: '30 minuti focalizzati su respiro e ambiente.', points: 20 },
            { id: 'anxiety1_w_4', title: 'Mindfulness', Icon: '🧘', description: '20 minuti di consapevolezza e presenza mentale.', points: 20 },
            { id: 'anxiety1_w_5', title: 'Bagno con Sali di Epsom', Icon: '🛁', description: '20 minuti per rilassare muscoli e tensione.', points: 30 },
            { id: 'anxiety1_w_6', title: 'Diario delle Emozioni', Icon: '📓', description: 'Scrivi pensieri ed emozioni per 15 minuti al giorno.', points: 20 },
            { id: 'anxiety1_w_7', title: 'Terapia dell’Abbraccio', Icon: '🤗', description: 'Abbraccia una persona cara per almeno 10 minuti.', points: 20 },
            { id: 'anxiety1_w_8', title: 'Aromaterapia', Icon: '🌸', description: 'Usa oli essenziali come lavanda o camomilla.', points: 20 },
            { id: 'anxiety1_w_9', title: 'Progresso Graduale', Icon: '📈', description: 'Pianifica e realizza piccoli obiettivi settimanali.', points: 20 },
            { id: 'anxiety1_w_10', title: 'Coping Positivo', Icon: '👍', description: 'Identifica e pratica tecniche di gestione emotiva.', points: 20 },
            { id: 'anxiety1_w_11', title: 'Gratitudine', Icon: '🙏', description: 'Scrivi 3 cose per cui sei grato ogni giorno.', points: 20 },
            { id: 'anxiety1_w_12', title: 'Musica Rilassante', Icon: '🎵', description: 'Ascolta musica per 20–30 minuti focalizzandoti sul rilassamento.', points: 10 },
            { id: 'anxiety1_w_13', title: 'Massaggio ai Piedi', Icon: '🦶', description: 'Usa una pallina da tennis o da massaggio.', points: 10 },
            { id: 'anxiety1_w_14', title: 'Grounding', Icon: '🌍', description: 'Focalizzati su 5 cose che puoi vedere, toccare, sentire, annusare e gustare.', points: 20 },
            { id: 'anxiety1_w_15', title: 'Espressione Creativa', Icon: '🎨', description: 'Disegna, dipingi, scrivi poesie o racconti.', points: 20 },
            { id: 'anxiety1_w_16', title: 'Giornata di Disconnessione', Icon: '📵', description: 'Trascorri una giornata senza dispositivi elettronici.', points: 30 },
            { id: 'anxiety1_w_17', title: 'Yoga Rilassante', Icon: '🧘‍♀️', description: 'Stretching dolce e respirazione consapevole.', points: 30 },
            { id: 'anxiety1_w_18', title: 'Meditazione Guidata per Ansia', Icon: '🎧', description: 'Ascolta una meditazione guidata specifica per l’ansia.', points: 20 },
            { id: 'anxiety1_w_19', title: 'Biofeedback (Ansia)', Icon: '💓', description: 'Sessione di coerenza cardiaca e monitoraggio.', points: 60 },
            { id: 'anxiety1_w_20', title: 'Tai Chi o Qigong', Icon: '🥋', description: 'Movimenti lenti e controllati per rilassare corpo e mente.', points: 30 },
            { id: 'anxiety1_w_21', title: 'Stimolazione Nervo Vago', Icon: '🧘', description: 'Tecniche vagali per ridurre lo stress.', points: 40 }
        ]
    },
    anxiety_stress_level_2: {
        id: 'anxiety_stress_level_2',
        name: 'Programma Ansia-Stress: Livello 2',
        subtitle: 'Oasi della Tranquillità',
        description: 'Include Attività Giornaliere più impegnative per migliorare la gestione di ansia e stress.',
        Icon: '🌲',
        dailyTarget: 40,
        unlocksAt: 2000,
        dependsOn: 'anxiety_stress_level_1',
        daily: [
            { id: 'anxiety2_d_1', title: 'Sessione di Mindfulness (20 minuti)', Icon: '🧘', description: 'Pratiche di consapevolezza e presenza mentale.', points: 20 },
            { id: 'anxiety2_d_2', title: 'Bagno con Sali di Epsom (20 minuti)', Icon: '🛁', description: 'Rilassa i muscoli e allevia la tensione.', points: 10 },
            { id: 'anxiety2_d_3', title: 'Terapia dell’Abbraccio (10 minuti)', Icon: '🤗', description: 'Abbraccia una persona cara per almeno 10 minuti.', points: 5 },
            { id: 'anxiety2_d_4', title: 'Aromaterapia (20 minuti)', Icon: '🌸', description: 'Usa oli essenziali come lavanda o camomilla.', points: 10 },
            { id: 'anxiety2_d_5', title: 'Grounding (cinque sensi)', Icon: '🌍', description: 'Focalizzati su ciò che puoi vedere, toccare, sentire, annusare e gustare.', points: 20 }
        ],
        weekly: []
    },
     anxiety_stress_level_3: {
        id: 'anxiety_stress_level_3',
        name: 'Programma Ansia-Stress: Livello 3',
        subtitle: 'Super Zen',
        description: 'Include Attività Giornaliere più avanzate per una gestione ottimale di ansia e stress.',
        Icon: '🕉️',
        dailyTarget: 60,
        unlocksAt: 2500,
        dependsOn: 'anxiety_stress_level_2',
        daily: [
            { id: 'anxiety3_d_1', title: 'Tecniche di Coping Positivo', Icon: '👍', description: 'Identifica e pratica strategie di gestione emotiva e resilienza.', points: 20 },
            { id: 'anxiety3_d_2', title: 'Espressione Creativa', Icon: '🎨', description: 'Disegna, dipingi, scrivi poesie o racconti per liberare le emozioni.', points: 20 },
            { id: 'anxiety3_d_3', title: 'Giornata di Disconnessione', Icon: '📵', description: 'Trascorri una giornata senza dispositivi elettronici.', points: 20 },
            { id: 'anxiety3_d_4', title: 'Meditazione Guidata per Ansia', Icon: '🎧', description: 'Ascolta una meditazione guidata specifica per l’ansia (20 minuti).', points: 20 },
            { id: 'anxiety3_d_5', title: 'Biofeedback per Ansia', Icon: '💓', description: 'Sessione di coerenza cardiaca e monitoraggio per ridurre lo stress.', points: 20 }
        ],
        weekly: []
    },
    activity_gold: {
        id: 'activity_gold',
        name: 'Sempre Giovani – Livello Gold',
        subtitle: 'Missione Attività Fisica Settimanale',
        description: 'Attività per over 65 con focus su mobilità, forza e resistenza. Sicurezza ed efficacia per il benessere quotidiano.',
        Icon: '🌟',
        numWeeks: 14,
        weeklyMinTarget: 65,
        weeklyMaxTarget: 150,
        daily: [],
        weekly: [
            { id: 'ag_w_1', title: 'Passeggiata Attiva', Icon: '🚶', description: '30 minuti a ritmo moderato.', points: 30 },
            { id: 'ag_w_2', title: 'Yoga Dolce', Icon: '🧘‍♀️', description: '45 minuti di esercizi dolci e respirazione.', points: 30 },
            { id: 'ag_w_3', title: 'Cyclette', Icon: '🚴', description: '20–30 minuti a ritmo moderato.', points: 40 },
            { id: 'ag_w_4', title: 'Resistenza Leggera', Icon: '🏋️', description: '20 minuti di esercizi con pesi leggeri o elastici.', points: 40 },
            { id: 'ag_w_5', title: 'Camminata in Natura', Icon: '🌳', description: '45 minuti all’aperto, in ambiente naturale.', points: 45 },
            { id: 'ag_w_6', title: 'Ginnastica in Acqua', Icon: '🏊', description: '30 minuti di esercizi in piscina.', points: 40 },
            { id: 'ag_w_7', title: 'Stretching e Mobilità', Icon: '🤸', description: '20–30 minuti di esercizi di flessibilità e mobilità articolare.', points: 25 },
            { id: 'ag_w_8', title: 'Zona 2 – Ciclismo o Camminata', Icon: '🚵', description: '45 minuti a ritmo moderato, 2 volte a settimana.', points: 60 },
            { id: 'ag_w_9', title: 'Nuoto Moderato', Icon: '🏊', description: '20 minuti di nuoto a ritmo costante.', points: 45 }
        ]
    },
    activity_sprint_1: {
        id: 'activity_sprint_1',
        name: 'Inizio Sprint – Livello 1',
        subtitle: 'Missione Attività Fisica Settimanale',
        description: 'Attività per iniziare il tuo percorso sportivo, con focus su camminata, resistenza e mobilità. Ideale per i più giovani o già allenati.',
        Icon: '🏃‍♂️',
        numWeeks: 14,
        weeklyMinTarget: 65,
        weeklyMaxTarget: 100,
        daily: [],
        weekly: [
            { id: 'as1_w_1', title: 'Camminata Veloce', Icon: '🚶‍♂️', description: '30 minuti a passo sostenuto.', points: 50 },
            { id: 'as1_w_2', title: 'Circuito di Resistenza', Icon: '🏋️‍♀️', description: 'Pesi leggeri, 3 set da 12 ripetizioni.', points: 60 },
            { id: 'as1_w_3', title: 'Yoga Dinamico', Icon: '🧘', description: '60 minuti di yoga attivo e fluido.', points: 50 },
            { id: 'as1_w_4', title: 'Nuoto', Icon: '🏊', description: '30 minuti a ritmo moderato.', points: 50 },
            { id: 'as1_w_5', title: 'Stretching e Mobilità', Icon: '🤸‍♂️', description: '20 minuti di esercizi per flessibilità e articolazioni.', points: 30 },
            { id: 'as1_w_6', title: 'Cyclette', Icon: '🚴', description: '30 minuti a ritmo costante.', points: 40 }
        ]
    },
    activity_sprint_2: {
        id: 'activity_sprint_2',
        name: 'Energia in Movimento – Livello 2',
        subtitle: 'Missione Attività Fisica Settimanale',
        description: 'Attività più avanzate per aumentare forza e resistenza. Ideale per chi è già allenato. Livello intermedio.',
        Icon: '🏋️‍♀️',
        numWeeks: 14,
        weeklyMinTarget: 100,
        weeklyMaxTarget: 160,
        unlocksAt: 1500,
        dependsOn: 'activity_sprint_1',
        daily: [],
        weekly: [
            { id: 'as2_w_1', title: 'Corsa Leggera', Icon: '🏃‍♂️', description: '30 minuti di corsa a ritmo costante.', points: 40 },
            { id: 'as2_w_2', title: 'Circuito Forza', Icon: '🏋️‍♂️', description: 'Pesi medi, 4 set da 10 ripetizioni.', points: 50 },
            { id: 'as2_w_3', title: 'HIIT', Icon: '💪', description: '20 minuti di allenamento ad alta intensità a intervalli.', points: 80 },
            { id: 'as2_w_4', title: 'Pilates', Icon: '🧘‍♀️', description: '60 minuti di esercizi per postura, core e flessibilità.', points: 40 },
            { id: 'as2_w_5', title: 'Nuoto Intenso', Icon: '🏊‍♂️', description: '45 minuti di nuoto a ritmo sostenuto.', points: 60 }
        ]
    },
    activity_sprint_3: {
        id: 'activity_sprint_3',
        name: 'Eccellenza Atletica – Livello 3',
        subtitle: 'Missione Attività Fisica Settimanale',
        description: 'Attività avanzate ad alta intensità per performance massime. Livello avanzato.',
        Icon: '🏅',
        numWeeks: 14,
        weeklyMinTarget: 100,
        weeklyMaxTarget: 180,
        unlocksAt: 1500,
        dependsOn: 'activity_sprint_2',
        daily: [],
        weekly: [
            { id: 'as3_w_1', title: 'Corsa Intensa', Icon: '🏃‍♀️', description: '45 minuti di corsa a ritmo sostenuto.', points: 30 },
            { id: 'as3_w_2', title: 'Allenamento Pesi Pesanti', Icon: '🏋️‍♂️', description: '5 set da 8 ripetizioni con carico elevato.', points: 40 },
            { id: 'as3_w_3', title: 'HIIT', Icon: '💥', description: '30 minuti di allenamento ad alta intensità a intervalli.', points: 40 },
            { id: 'as3_w_4', title: 'Yoga di Potenza', Icon: '🧘‍♂️', description: '75 minuti di yoga intensivo per forza e resistenza.', points: 30 },
            { id: 'as3_w_5', title: 'Nuoto a Stile Libero', Icon: '🏊‍♀️', description: '60 minuti di nuoto continuo a ritmo sostenuto.', points: 40 }
        ]
    },
    stress: {
        id: 'stress',
        name: 'Stress Management',
        description: 'Missioni mirate a ridurre lo stress, trovare equilibrio e coltivare la calma nella vita quotidiana.',
        subtitle: 'La Settimana del Successo',
        Icon: '🧘‍♀️',
        isSmart: true,
        numWeeks: 10,
        dailyTarget: 50,
        weeklyMinTarget: 350,
        daily: [
            { id: 'stress_d_1', title: 'Respirazione Profonda', Icon: '🌬️', description: '5 minuti di respirazione diaframmatica per calmare il sistema nervoso.', points: 15 },
            { id: 'stress_d_2', title: 'Pausa Consapevole', Icon: '⏸️', description: 'Ogni 90 minuti, fai una pausa di 2 minuti lontano dagli schermi.', points: 10 },
            { id: 'stress_d_3', title: 'Diario della Gratitudine', Icon: '🙏', description: 'Scrivi 3 cose per cui sei grato oggi.', points: 10 },
            { id: 'stress_d_4', title: 'Movimento Dolce', Icon: '🚶‍♀️', description: '15 minuti di stretching leggero o camminata lenta.', points: 10 },
            { id: 'stress_d_5', title: 'Tisana Rilassante', Icon: '🍵', description: 'Bevi una tisana (camomilla, melissa) prima di dormire.', points: 5 }
        ],
        weekly: [
            { id: 'stress_w_1', title: 'Meditazione o Yoga', Icon: '🧘', description: 'Dedica 30 minuti a una sessione di yoga o meditazione guidata.', points: 100 },
            { id: 'stress_w_2', title: 'Tempo nella Natura', Icon: '🌳', description: 'Trascorri almeno 1 ora in un parco, bosco o al mare.', points: 150 },
            { id: 'stress_w_3', title: 'Hobby De-Stress', Icon: '🎨', description: 'Dedica 1 ora a un hobby che ti rilassa e ti piace (senza schermi).', points: 100 }
        ]
    },
    performance: {
        id: 'performance',
        name: 'Programma Performance',
        description: 'Massimizza la tua energia fisica e mentale, migliora la concentrazione e raggiungi i tuoi obiettivi con più efficacia.',
        subtitle: 'La Settimana del Successo',
        Icon: '🚀',
        isSmart: true,
        numWeeks: 10,
        dailyTarget: 55,
        weeklyMinTarget: 350,
        daily: [
            { id: 'perf_d_1', title: 'Colazione Energetica', Icon: '🍳', description: 'Fai una colazione ricca di proteine e grassi sani.', points: 10 },
            { id: 'perf_d_2', title: 'Idratazione Strategica', Icon: '💧', description: 'Bevi un bicchiere d\'acqua ogni ora. Obiettivo: 2 litri.', points: 10 },
            { id: 'perf_d_3', title: 'Allenamento Focus', Icon: '🏋️', description: '30 minuti di attività fisica mirata (corsa, pesi, HIIT).', points: 20 },
            { id: 'perf_d_4', title: 'Micro-Pausa Attiva', Icon: '🏃', description: 'Fai 5 minuti di stretching o camminata ogni 90 minuti di lavoro seduto.', points: 5 },
            { id: 'perf_d_5', title: 'Pianificazione del Domani', Icon: '📝', description: 'Dedica 5 minuti la sera a pianificare le 3 priorità del giorno dopo.', points: 10 }
        ],
        weekly: [
            { id: 'perf_w_1', title: 'Allenamento Intenso', Icon: '🔥', description: 'Completa 2 sessioni di allenamento ad alta intensità (HIIT).', points: 150 },
            { id: 'perf_w_2', title: 'Apprendimento Attivo', Icon: '🧠', description: 'Dedica 1 ora all\'apprendimento di una nuova abilità o argomento.', points: 100 },
            { id: 'perf_w_3', title: 'Revisione Settimanale', Icon: '📈', description: 'Rivedi i progressi della settimana e fissa gli obiettivi per la prossima.', points: 100 }
        ]
    },
    longevity: {
        id: 'longevity',
        name: 'Programma Longevità',
        description: "Adotta abitudini basate sulla scienza per promuovere un invecchiamento sano, mantenere la vitalità e prevenire le malattie.",
        subtitle: 'La Settimana del Successo',
        Icon: '⏳',
        isSmart: true,
        numWeeks: 10,
        dailyTarget: 45,
        weeklyMinTarget: 400,
        daily: [
            { id: 'longev_d_1', title: 'Dieta Antiossidante', Icon: '🍇', description: 'Consuma almeno 2 porzioni di frutti di bosco, verdure a foglia scura o tè verde.', points: 10 },
            { id: 'longev_d_2', title: '10.000 Passi', Icon: '👟', description: 'Raggiungi l\'obiettivo di 10.000 passi durante la giornata.', points: 15 },
            { id: 'longev_d_3', title: 'Grassi Sani', Icon: '🥑', description: 'Includi una fonte di grassi sani (avocado, noci, olio EVO) nei tuoi pasti.', points: 10 },
            { id: 'longev_d_4', title: 'Allenamento Mentale', Icon: '🧠', description: 'Dedica 15 minuti ad attività che sfidano la mente (puzzle, lettura complessa, nuova lingua).', points: 10 }
        ],
        weekly: [
            { id: 'longev_w_1', title: 'Forza Muscolare', Icon: '💪', description: 'Completa 2 sessioni di allenamento con i pesi per mantenere la massa muscolare.', points: 150 },
            { id: 'longev_w_2', title: 'Connessione Sociale', Icon: '🧑‍🤝‍🧑', description: 'Passa del tempo di qualità e significativo con amici o familiari.', points: 100 },
            { id: 'longev_w_3', 'title': 'Legumi Power', 'Icon': '🌱', 'description': 'Consuma legumi (fagioli, lenticchie, ceci) almeno 3 volte a settimana.', 'points': 100 },
            { id: 'longev_w_4', title: 'Finestra Alimentare', Icon: '⌛', description: 'Prova a concentrare i pasti in una finestra di 8-10 ore.', points: 50 }
        ]
    }
};



// --- COMPONENTS ---

const LoginScreen = ({ onLogin }) => {
    const [name, setName] = React.useState('');
    const [email, setEmail] = React.useState('');

    const handleSubmit = (e) => {
        e.preventDefault();
        if (name.trim() && email.trim()) {
            onLogin({ name: name.trim(), email: email.trim() });
        }
    };

    return (
        <div className="flex items-center justify-center min-h-screen bg-sky-50">
            <div className="w-full max-w-md p-8 space-y-8 bg-white shadow-2xl rounded-2xl animate-fade-in">
                <div className="text-center">
                    <h1 className="text-4xl font-bold text-slate-800">Clinical Wellness Spa</h1>
                    <p className="mt-2 text-lg text-slate-600">Il tuo percorso verso il benessere inizia qui.</p>
                </div>
                <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
                    <div className="rounded-md shadow-sm">
                        <div className="mb-4">
                            <label htmlFor="name" className="block text-sm font-medium text-slate-700 mb-1">Nome</label>
                            <input
                                id="name"
                                name="name"
                                type="text"
                                required
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                className="appearance-none relative block w-full px-3 py-3 border border-slate-300 placeholder-slate-500 text-slate-900 rounded-md focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"
                                placeholder="Il tuo nome"
                            />
                        </div>
                        <div>
                            <label htmlFor="email-address" className="block text-sm font-medium text-slate-700 mb-1">Indirizzo Email</label>
                            <input
                                id="email-address"
                                name="email"
                                type="email"
                                autoComplete="email"
                                required
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                className="appearance-none relative block w-full px-3 py-3 border border-slate-300 placeholder-slate-500 text-slate-900 rounded-md focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"
                                placeholder="indirizzo@esempio.com"
                            />
                        </div>
                    </div>

                    <div>
                        <button
                            type="submit"
                            disabled={!name.trim() || !email.trim()}
                            className="group relative w-full flex justify-center py-3 px-4 mt-6 border border-transparent text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:bg-slate-400 disabled:cursor-not-allowed transition-colors"
                        >
                            Entra nell'App
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
};

const LineChart = ({ data, width = 400, height = 200, color = "#0ea5e9" }) => {
    if (!data || data.length < 2) {
        return <div className="flex items-center justify-center h-full text-slate-500">Dati insufficienti per il grafico.</div>;
    }

    const padding = 20;
    const chartWidth = width - padding * 2;
    const chartHeight = height - padding * 2;

    const yMax = 80;
    const yMin = 20;

    const getX = (index) => (index / (data.length - 1)) * chartWidth + padding;
    const getY = (score) => chartHeight - ((score - yMin) / (yMax - yMin)) * chartHeight + padding;

    const path = data
        .map((d, i) => `${i === 0 ? 'M' : 'L'} ${getX(i)} ${getY(d.score)}`)
        .join(' ');

    return (
        <svg viewBox={`0 0 ${width} ${height}`} aria-label="Grafico dell'andamento dei punteggi">
            <path d={path} fill="none" stroke={color} strokeWidth="2" />
            {data.map((d, i) => (
                <g key={i}>
                    <circle cx={getX(i)} cy={getY(d.score)} r="4" fill={color} />
                    <title>{`Punteggio: ${d.score}\nData: ${new Date(d.date).toLocaleDateString('it-IT')}`}</title>
                </g>
            ))}
            <text x={padding - 5} y={getY(yMin)} textAnchor="end" dominantBaseline="middle" className="text-xs fill-slate-500">{yMin}</text>
            <text x={padding - 5} y={getY(yMax)} textAnchor="end" dominantBaseline="middle" className="text-xs fill-slate-500">{yMax}</text>
        </svg>
    );
};

const WellnessDashboard = ({ user, onNavigate }) => {
    const [dashboardData, setDashboardData] = React.useState([]);
    
    React.useEffect(() => {
        const data = Object.keys(assessmentsData).map(assessmentId => {
            const history = JSON.parse(localStorage.getItem(`assessmentHistory_${user.email}_${assessmentId}`) || '[]');
            const { title, Icon } = assessmentsData[assessmentId];
            
            const latestScore = history.length > 0 ? history[history.length - 1].score : null;
            let trend = 0; // 0 for no change, 1 for up, -1 for down
            if (history.length > 1) {
                const last = history[history.length - 1].score;
                const secondLast = history[history.length - 2].score;
                if (last > secondLast) trend = 1;
                if (last < secondLast) trend = -1;
            }

            return {
                id: assessmentId,
                title,
                Icon,
                history,
                latestScore,
                trend
            };
        });
        setDashboardData(data);
    }, [user.email]);

    const TrendIcon = ({ trend }) => {
        if (trend === 1) return <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 text-green-500"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
        if (trend === -1) return <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 text-red-500"><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></svg>;
        return <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 text-slate-500"><line x1="5" y1="12" x2="19" y2="12"/></svg>;
    }

    return (
        <div className="p-4 md:p-8 animate-fade-in">
            <h1 className="text-4xl font-bold text-slate-800 mb-2">Dashboard Benessere</h1>
            <p className="text-xl text-slate-600 mb-8">I tuoi progressi nel tempo.</p>
            
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {dashboardData.map(data => (
                    <div key={data.id} className="bg-white rounded-2xl shadow-lg p-6">
                        <div className="flex items-center justify-between mb-4">
                            <div className="flex items-center gap-3">
                                <div className="p-2 bg-sky-100 rounded-full">
                                    <data.Icon className="w-6 h-6 text-sky-600" />
                                </div>
                                <h2 className="text-xl font-bold text-slate-700">{data.title}</h2>
                            </div>
                            {data.latestScore !== null && (
                                <div className="flex items-center gap-2 p-2 bg-slate-100 rounded-lg">
                                    <span className="text-lg font-bold text-slate-800">{data.latestScore}</span>
                                    <TrendIcon trend={data.trend} />
                                </div>
                            )}
                        </div>
                        
                        {data.history.length > 0 ? (
                            <div>
                                <LineChart data={data.history} />
                                <div className="text-center mt-4">
                                    <button onClick={() => onNavigate('assessments')} className="text-sky-600 font-semibold hover:text-sky-800 transition-colors text-sm">
                                        Ripeti il test →
                                    </button>
                                </div>
                            </div>
                        ) : (
                             <div className="text-center py-10">
                                <p className="text-slate-500 mb-4">Non hai ancora completato questo test.</p>
                                <button onClick={() => onNavigate('assessments')} className="px-5 py-2 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 transition-colors">
                                    Inizia il test
                                </button>
                            </div>
                        )}
                    </div>
                ))}
            </div>
        </div>
    );
};

const BreathingScreen = () => {
    const BREATHING_PATTERNS = {
      coherence: { name: '5-5 Coerenza Cardiaca', inhale: 5, hold: 0, exhale: 5, total: 10 },
      vagotonia: { name: '4-6 Vagotonia', inhale: 4, hold: 0, exhale: 6, total: 10 },
      sleep: { name: '4-7-8 Sonno', inhale: 4, hold: 7, exhale: 8, total: 19 },
      training: { name: '6-6 Allenamento', inhale: 6, hold: 0, exhale: 6, total: 12 },
    };

    const DURATION_OPTIONS = [
        { label: '1 Minuto', value: 60 },
        { label: '5 Minuti', value: 300 },
        { label: '10 Minuti', value: 600 },
        { label: '15 Minuti', value: 900 },
    ];

    const [duration, setDuration] = React.useState(DURATION_OPTIONS[0].value);
    const [patternKey, setPatternKey] = React.useState('coherence');
    const [isActive, setIsActive] = React.useState(false);
    const [timeLeft, setTimeLeft] = React.useState(DURATION_OPTIONS[0].value);
    const [cycles, setCycles] = React.useState(0);
    const [instruction, setInstruction] = React.useState('Inizia');
    const [scale, setScale] = React.useState(0.6);

    const mainTimer = React.useRef(null);
    const cycleTimer = React.useRef(null);
    const audioRef = React.useRef(null);

    React.useEffect(() => {
        // Cleanup audio when component unmounts
        const audioEl = audioRef.current;
        return () => {
            if (audioEl) {
                audioEl.pause();
            }
        };
    }, []);

    React.useEffect(() => {
        if (isActive && timeLeft > 0) {
            mainTimer.current = setInterval(() => {
                setTimeLeft(t => t - 1);
            }, 1000);
        } else if (timeLeft === 0 && isActive) {
            setIsActive(false);
             if (audioRef.current) {
                audioRef.current.pause();
                audioRef.current.currentTime = 0;
            }
            alert('Sessione di respirazione completata!');
        }
        return () => clearInterval(mainTimer.current);
    }, [isActive, timeLeft]);

    React.useEffect(() => {
        if (!isActive) {
            clearTimeout(cycleTimer.current);
            setInstruction('Inizia');
            setScale(0.6);
            return;
        }

        const pattern = BREATHING_PATTERNS[patternKey];
        
        const breathingCycle = () => {
            setInstruction('Inspira...');
            setScale(1);

            cycleTimer.current = setTimeout(() => {
                if (pattern.hold > 0) {
                    setInstruction('Trattieni');
                }

                cycleTimer.current = setTimeout(() => {
                    setInstruction('...espira');
                    setScale(0.6);

                    cycleTimer.current = setTimeout(() => {
                        setCycles(c => c + 1);
                        if (isActive) breathingCycle();
                    }, pattern.exhale * 1000);
                }, pattern.hold * 1000);
            }, pattern.inhale * 1000);
        };

        breathingCycle();

        return () => clearTimeout(cycleTimer.current);
    }, [isActive, patternKey]);

    const handleStartStop = () => {
        if (isActive) {
            setIsActive(false);
            if (audioRef.current) {
                audioRef.current.pause();
                audioRef.current.currentTime = 0;
            }
        } else {
            setTimeLeft(duration);
            setCycles(0);
            setIsActive(true);
            if (audioRef.current) {
                audioRef.current.play().catch(e => console.error("Audio playback failed:", e));
            }
        }
    };
    
    const formatTime = (seconds) => {
        const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
        const secs = String(seconds % 60).padStart(2, '0');
        return `${mins}:${secs}`;
    };

    const currentPattern = BREATHING_PATTERNS[patternKey];
    const circleTransitionDuration = isActive
        ? (instruction === 'Inspira...' ? currentPattern.inhale : currentPattern.exhale)
        : 1;

    return (
        <div className="p-4 md:p-8 animate-fade-in flex flex-col items-center justify-center h-full">
            <div className="w-full max-w-2xl">
                <h1 className="text-4xl font-bold text-slate-800 mb-4 text-center">Coerenza Cardiaca</h1>
                
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">
                    <div>
                        <label htmlFor="duration-select" className="block text-sm font-medium text-slate-700 mb-1">Durata Sessione:</label>
                        <select 
                            id="duration-select"
                            value={duration} 
                            onChange={e => setDuration(Number(e.target.value))}
                            disabled={isActive}
                            className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 disabled:bg-slate-100"
                        >
                            {DURATION_OPTIONS.map(opt => <option key={opt.value} value={opt.value}>{opt.label}</option>)}
                        </select>
                    </div>
                     <div>
                        <label htmlFor="pattern-select" className="block text-sm font-medium text-slate-700 mb-1">Ritmo Respirazione:</label>
                        <select 
                            id="pattern-select"
                            value={patternKey}
                            onChange={e => setPatternKey(e.target.value)}
                            disabled={isActive}
                            className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 disabled:bg-slate-100"
                        >
                            {Object.entries(BREATHING_PATTERNS).map(([key, pat]) => <option key={key} value={key}>{pat.name}</option>)}
                        </select>
                    </div>
                </div>

                <div className="relative w-64 h-64 md:w-80 md:h-80 flex items-center justify-center mx-auto">
                    <div className="absolute w-full h-full bg-sky-200 rounded-full opacity-50"></div>
                    <div 
                        className="absolute w-full h-full bg-sky-300 rounded-full"
                        style={{ 
                            transform: `scale(${scale})`,
                            transition: `transform ${circleTransitionDuration}s ease-in-out`
                        }}
                    ></div>
                    <span className="relative text-2xl font-semibold text-sky-800 z-10">{instruction}</span>
                </div>

                <div className="flex justify-around items-center mt-8 text-center">
                    <div>
                        <p className="text-slate-500">Cicli completati</p>
                        <p className="text-3xl font-bold text-slate-800">{cycles}</p>
                    </div>
                    <div>
                         <p className="text-slate-500">Tempo residuo</p>
                         <p className="text-3xl font-bold text-slate-800">{formatTime(isActive ? timeLeft : duration)}</p>
                    </div>
                </div>

                <button
                    onClick={handleStartStop}
                    className="w-full max-w-xs mx-auto mt-8 block px-8 py-4 bg-sky-600 text-white font-bold text-lg rounded-full shadow-lg hover:bg-sky-700 active:bg-sky-800 transition-colors"
                >
                    {isActive ? 'Ferma Esercizio' : 'Inizia Esercizio'}
                </button>
            </div>
            <audio ref={audioRef} src="https://files.catbox.moe/zc81yy.mp3" loop />
        </div>
    );
};

const Notification = ({ notification, onClose }) => {
    const [isFadingOut, setIsFadingOut] = React.useState(false);

    React.useEffect(() => {
        const fadeOutTimer = setTimeout(() => {
            setIsFadingOut(true);
        }, 3000); // Start fading out after 3 seconds

        return () => clearTimeout(fadeOutTimer);
    }, []);
    
    React.useEffect(() => {
        if (isFadingOut) {
            const closeTimer = setTimeout(onClose, 300); // Corresponds to animation duration
            return () => clearTimeout(closeTimer);
        }
    }, [isFadingOut, onClose]);

    const typeClasses = {
        success: {
            bg: 'bg-green-500',
            icon: <CheckCircleIcon className="w-6 h-6 text-white"/>
        },
        error: {
            bg: 'bg-red-500',
            icon: <XCircleIcon className="w-6 h-6 text-white"/>
        }
    };

    const currentType = typeClasses[notification.type] || typeClasses.success;

    return (
        <div className={`fixed top-5 right-5 z-50 flex items-center p-4 rounded-lg shadow-lg text-white ${currentType.bg} ${isFadingOut ? 'animate-toast-out' : 'animate-toast-in'}`}>
            <div className="mr-3">{currentType.icon}</div>
            <div className="font-semibold">{notification.message}</div>
            <button onClick={() => setIsFadingOut(true)} className="ml-4 -mr-2 p-1 rounded-full hover:bg-white/20 transition-colors">
                 <XIcon className="w-5 h-5"/>
            </button>
        </div>
    );
};

const Sidebar = ({ user, currentPage, onNavigate, onLogout, isOpen, setIsOpen }) => {
    const navItems = [
        { id: 'home', label: 'Home', Icon: HomeIcon },
        { id: 'profile', label: 'Profilo', Icon: UserIcon },
        { id: 'assessments', label: 'Test Autovalutazione', Icon: BookOpenIcon },
        { id: 'dashboard', label: 'Dashboard Benessere', Icon: AreaChartIcon },
        { id: 'wellnessRoutine', label: 'Routine Benessere', Icon: SparklesIcon },
        { id: 'breathing', label: 'Coerenza Cardiaca', Icon: LungIcon },
        { id: 'bloodAnalysis', label: 'Analisi HRV', Icon: BeakerIcon },
        { id: 'prescriptions', label: 'Ricette Mediche', Icon: ClipboardPlusIcon },
        { id: 'bookings', label: 'Programmi & Trattamenti', Icon: CalendarClockIcon },
    ];

    const sidebarContent = (
        <>
            <div className="p-4 border-b border-sky-700">
                <h1 className="text-2xl font-bold text-white">Wellness Spa</h1>
                {user && <p className="text-sky-200 text-sm">Benvenuto, {user.name}</p>}
            </div>
            <nav className="flex-grow p-2">
                <ul>
                    {navItems.map(item => (
                        <li key={item.id}>
                            <a
                                href="#"
                                onClick={(e) => {
                                    e.preventDefault();
                                    onNavigate(item.id);
                                    if (window.innerWidth < 768) setIsOpen(false);
                                }}
                                className={`flex items-center gap-3 p-3 my-1 rounded-md text-lg transition-colors ${
                                    currentPage === item.id 
                                    ? 'bg-sky-500 text-white shadow-md' 
                                    : 'text-sky-100 hover:bg-sky-600'
                                }`}
                            >
                                <item.Icon className="sidebar-icon" />
                                <span>{item.label}</span>
                            </a>
                        </li>
                    ))}
                </ul>
            </nav>
            <div className="p-4 border-t border-sky-700">
                <a
                    href="#"
                    onClick={(e) => {
                        e.preventDefault();
                        onLogout();
                        if (window.innerWidth < 768) setIsOpen(false);
                    }}
                    className="flex items-center gap-3 p-3 rounded-md text-lg text-sky-100 hover:bg-sky-600 transition-colors"
                >
                    <LoginIcon className="sidebar-icon" />
                    <span>Logout</span>
                </a>
            </div>
        </>
    );

    return (
        <>
            {/* Overlay for mobile */}
            {isOpen && <div className="fixed inset-0 bg-black opacity-50 z-30 md:hidden" onClick={() => setIsOpen(false)}></div>}
            
            {/* Sidebar */}
            <aside className={`fixed top-0 left-0 h-full w-64 bg-sky-800 text-white flex flex-col shadow-lg z-40 transform transition-transform duration-300 ease-in-out ${isOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0`}>
                {sidebarContent}
            </aside>
        </>
    );
};

const Quiz = ({ assessment, onComplete }) => {
    const [answers, setAnswers] = React.useState({});
    const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);

    const handleAnswer = (questionIndex, value) => {
        setAnswers(prevAnswers => ({ ...prevAnswers, [questionIndex]: value }));
    };

    React.useEffect(() => {
        const allQuestionsAnswered = Object.keys(answers).length > 0 && Object.keys(answers).length === assessment.questions.length;
        if (allQuestionsAnswered) {
            // Fix: Explicitly type the accumulator `sum` and `value` as numbers to resolve a type inference issue with Object.values.
            const score = Object.values(answers).reduce((sum, value) => sum + value, 0);
            const timerId = setTimeout(() => onComplete(score), 350);
            return () => clearTimeout(timerId);
        }
    }, [answers, assessment.questions.length, onComplete]);

    React.useEffect(() => {
        if (answers[currentQuestionIndex] !== undefined) {
            const isLastQuestion = currentQuestionIndex === assessment.questions.length - 1;
            if (!isLastQuestion) {
                const timerId = setTimeout(() => {
                    setCurrentQuestionIndex(prevIndex => prevIndex + 1);
                }, 300);
                return () => clearTimeout(timerId);
            }
        }
    }, [answers, currentQuestionIndex, assessment.questions.length]);


    const allAnswered = Object.keys(answers).length === assessment.questions.length;

    if (allAnswered) {
        return (
            <div className="p-4 md:p-8 text-center animate-fade-in">
                <h2 className="text-2xl font-bold text-slate-700">Calcolo dei risultati...</h2>
            </div>
        );
    }
        
    const currentQuestion = assessment.questions[currentQuestionIndex];
    const progress = (currentQuestionIndex / assessment.questions.length) * 100;

    return (
        <div className="p-4 md:p-8 animate-fade-in">
            <h2 className="text-3xl font-bold text-slate-800 mb-2">{assessment.title}</h2>
            <p className="text-slate-600 mb-6">Domanda {currentQuestionIndex + 1} di {assessment.questions.length}</p>

            <div className="w-full bg-gray-200 rounded-full h-2.5 mb-8">
                <div className="bg-sky-500 h-2.5 rounded-full" style={{ width: `${progress}%`, transition: 'width 0.5s ease-in-out' }}></div>
            </div>

            <div className="bg-white p-6 rounded-lg shadow-md animate-slide-in-up" key={currentQuestionIndex}>
                <h3 className="text-xl font-semibold text-slate-700 mb-6">{currentQuestion.text}</h3>
                <div className="space-y-3">
                    {currentQuestion.options.map((option, optionIndex) => (
                        <button
                            key={optionIndex}
                            onClick={() => handleAnswer(currentQuestionIndex, option.value)}
                            className={`w-full text-left p-4 rounded-lg border-2 transition-all duration-200 text-slate-700 ${
                                answers[currentQuestionIndex] === option.value
                                ? 'bg-sky-100 border-sky-500 font-semibold ring-2 ring-sky-300'
                                : 'bg-slate-50 border-slate-200 hover:bg-sky-50 hover:border-sky-400'
                            }`}
                        >
                            {option.text}
                        </button>
                    ))}
                </div>
            </div>
        </div>
    );
};


const Results = ({ assessment, score, onRetake, onBackToHome }) => {
    const result = assessment.results.find(r => score >= r.scoreMin && score <= r.scoreMax) 
        || assessment.results.sort((a,b) => a.scoreMin - b.scoreMin)[0]; // Fallback to lowest result

    return (
        <div className="p-4 md:p-8 text-center animate-fade-in">
            <div className="bg-white p-8 rounded-2xl shadow-lg max-w-2xl mx-auto">
                <h2 className="text-3xl font-bold text-slate-800 mb-2">{result.title}</h2>
                <p className="text-lg text-slate-600 mb-4">Il tuo punteggio: <span className="font-bold text-sky-600">{score}</span></p>
                <div
                    className="prose text-slate-700 text-left my-6 mx-auto"
                    dangerouslySetInnerHTML={{ __html: marked.parse(result.summary) }}
                ></div>
                 <div className="flex justify-center gap-4 mt-8">
                    <button
                        onClick={onRetake}
                        className="px-6 py-3 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 transition-colors"
                    >
                        Ripeti il test
                    </button>
                    <button
                        onClick={onBackToHome}
                        className="px-6 py-3 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 transition-colors shadow-md"
                    >
                        Torna alla Home
                    </button>
                </div>
            </div>
        </div>
    );
};

const WellnessScore = ({ user, onNavigate }) => {
    const [lowestScore, setLowestScore] = React.useState(null);

    React.useEffect(() => {
        let scores = [];
        for (const assessmentId of Object.keys(assessmentsData)) {
            const storedHistory = JSON.parse(localStorage.getItem(`assessmentHistory_${user.email}_${assessmentId}`) || '[]');
            if (storedHistory.length > 0) {
                const latestScore = storedHistory[storedHistory.length - 1];
                scores.push({
                    id: assessmentId,
                    title: assessmentsData[assessmentId].title.replace('Analisi ', ''),
                    score: latestScore.score,
                    Icon: assessmentsData[assessmentId].Icon
                });
            }
        }

        if (scores.length > 0) {
            scores.sort((a, b) => a.score - b.score);
            setLowestScore(scores[0]);
        }
    }, [user.email]);

    if (!lowestScore) {
        return (
            <div className="bg-sky-600 text-white rounded-xl shadow-lg p-6 mb-8 animate-fade-in">
                <div className="flex items-center gap-4">
                    <SparklesIcon className="w-10 h-10 text-sky-300 flex-shrink-0" />
                    <div>
                        <h2 className="text-xl font-bold">Inizia il tuo percorso di benessere!</h2>
                        <p className="text-sky-200">Completa il tuo primo test di autovalutazione per scoprire i tuoi punti di forza.</p>
                    </div>
                </div>
                <button 
                    onClick={() => onNavigate('assessments')}
                    className="mt-4 w-full bg-white text-sky-700 font-bold py-2 px-4 rounded-lg hover:bg-sky-100 transition-colors"
                >
                    Inizia il primo test
                </button>
            </div>
        );
    }

    const { Icon, title, score, id } = lowestScore;

    return (
        <div className="bg-white rounded-xl shadow-lg p-6 mb-8 animate-fade-in border border-slate-200">
             <h3 className="text-sm font-semibold text-slate-500 mb-2">Focus Benessere</h3>
             <div className="flex items-start gap-4">
                 <div className="p-3 bg-red-100 rounded-full">
                     <TrendingDownIcon className="w-6 h-6 text-red-600" />
                 </div>
                 <div className="flex-grow">
                     <h2 className="text-xl font-bold text-slate-800">Area da Migliorare: {title}</h2>
                     <p className="text-slate-600">Il tuo ultimo punteggio è <span className="font-bold text-red-600">{score}</span>. Concentrati su quest'area per migliorare il tuo benessere generale.</p>
                     <button
                         onClick={() => onNavigate('assessments')}
                         className="mt-3 text-sky-600 font-semibold hover:text-sky-800 transition-colors text-sm"
                     >
                         Vai ai test di valutazione →
                     </button>
                 </div>
             </div>
        </div>
    );
};


const HomeScreen = ({ user, onNavigate }) => {
    const homeCards = [
      { id: 'assessments', title: 'Test Autovalutazione', subtitle: 'Scopri il tuo benessere', Icon: BookOpenIcon },
      { id: 'dashboard', title: 'Dashboard Benessere', subtitle: 'Visualizza i tuoi progressi', Icon: AreaChartIcon },
      { id: 'wellnessRoutine', title: 'Routine Benessere', subtitle: 'Completa le tue missioni', Icon: SparklesIcon },
      { id: 'breathing', title: 'Coerenza Cardiaca', subtitle: 'Esercizi di respirazione', Icon: LungIcon },
      { id: 'bookings', title: 'Programmi & Trattamenti', subtitle: 'Scopri i percorsi benessere', Icon: CalendarClockIcon },
      { id: 'prescriptions', title: 'Ricette Mediche', subtitle: 'Invia le ricette alla farmacia', Icon: ClipboardPlusIcon },
    ];
  
    return (
        <div className="p-4 md:p-8 animate-fade-in">
            <header className="mb-8">
                <h1 className="text-4xl font-bold text-slate-800">Bentornato, {user.name}!</h1>
                <p className="text-xl text-slate-600">Il tuo coach personale per il benessere.</p>
            </header>
            
            <WellnessScore user={user} onNavigate={onNavigate} />

            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {homeCards.map(card => (
                    <div
                        key={card.id}
                        onClick={() => onNavigate(card.id)}
                        className="bg-white rounded-xl shadow-md p-6 flex flex-col justify-between items-start cursor-pointer hover:shadow-xl hover:scale-105 transition-all duration-300 animate-slide-in-up"
                    >
                        <div>
                            <div className="p-3 bg-sky-100 rounded-full mb-4 inline-block">
                                <card.Icon className="w-8 h-8 text-sky-600" />
                            </div>
                            <h2 className="text-xl font-bold text-slate-800">{card.title}</h2>
                            <p className="text-slate-500 mt-1">{card.subtitle}</p>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
};

const ProfileScreen = ({ user, onLogout, onNavigate }) => {
    return (
        <div className="p-4 md:p-8 animate-fade-in">
            <h1 className="text-4xl font-bold text-slate-800 mb-8">Profilo Utente</h1>
            <div className="bg-white p-8 rounded-2xl shadow-lg max-w-md mx-auto">
                <div className="text-center mb-6">
                    <div className="w-24 h-24 rounded-full bg-sky-100 mx-auto flex items-center justify-center mb-4">
                        <UserIcon className="w-12 h-12 text-sky-600" />
                    </div>
                    <h2 className="text-2xl font-bold text-slate-800">{user.name}</h2>
                    <p className="text-slate-500">{user.email}</p>
                </div>
                <div className="border-t border-slate-200 pt-6 space-y-4">
                    <button
                        onClick={() => onNavigate('manualUnlock')}
                        className="w-full bg-sky-600 text-white font-semibold py-3 rounded-lg hover:bg-sky-700 transition-colors shadow-md flex items-center justify-center gap-2"
                    >
                        <KeyIcon className="w-5 h-5"/>
                        <span>Sblocco Manuale Livelli</span>
                    </button>
                    <button
                        onClick={onLogout}
                        className="w-full bg-red-500 text-white font-semibold py-3 rounded-lg hover:bg-red-600 transition-colors shadow-md"
                    >
                        Logout
                    </button>
                </div>
            </div>
        </div>
    );
};

const ManualUnlockScreen = ({ user, onNavigate, showNotification }) => {
    const [passwordInputs, setPasswordInputs] = React.useState({});

    const handleUnlock = (programId) => {
        const enteredPassword = passwordInputs[programId];
        const correctPassword = levelPasswords[programId];

        if (enteredPassword === correctPassword) {
            const storageKey = `manualUnlocks_${user.email}`;
            const existingUnlocks = JSON.parse(localStorage.getItem(storageKey) || '[]');
            const newUnlocks = [...new Set([...existingUnlocks, programId])];
            localStorage.setItem(storageKey, JSON.stringify(newUnlocks));
            showNotification('Livello sbloccato con successo!', 'success');
        } else {
            showNotification('Password errata. Riprova.', 'error');
        }
    };
    
    const lockedPrograms = Object.values(wellnessProgramsData).filter(p => p.unlocksAt);

    return (
        <div className="p-4 md:p-8 animate-fade-in">
            <button onClick={() => onNavigate('profile')} className="flex items-center gap-2 text-sky-600 font-semibold mb-6 hover:text-sky-800 transition-colors">
                <ArrowLeftIcon className="w-5 h-5" />
                <span>Torna al Profilo</span>
            </button>
            <h1 className="text-4xl font-bold text-slate-800 mb-2">Sblocco Manuale Livelli</h1>
            <p className="text-xl text-slate-600 mb-8">Inserisci la password per accedere direttamente a un livello.</p>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <div className="bg-white p-6 rounded-2xl shadow-lg space-y-6">
                        {lockedPrograms.map(p => (
                            <div key={p.id}>
                                <h3 className="font-bold text-slate-700">{p.name} - {p.subtitle}</h3>
                                <div className="flex items-center gap-2 mt-2">
                                    <input
                                        type="password"
                                        placeholder="Inserisci la password"
                                        value={passwordInputs[p.id] || ''}
                                        onChange={(e) => setPasswordInputs({...passwordInputs, [p.id]: e.target.value})}
                                        className="flex-grow p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500"
                                    />
                                    <button
                                        onClick={() => handleUnlock(p.id)}
                                        className="px-4 py-2 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 transition-colors"
                                    >
                                        Sblocca
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>

                <div className="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 className="text-2xl font-bold text-slate-800 mb-4">🧾 Riepilogo Password</h2>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm text-left text-slate-600">
                            <thead className="text-xs text-slate-700 uppercase bg-slate-100">
                                <tr>
                                    <th scope="col" className="px-4 py-3">Programma</th>
                                    <th scope="col" className="px-4 py-3">Livello</th>
                                    <th scope="col" className="px-4 py-3">Password</th>
                                </tr>
                            </thead>
                            <tbody>
                                {passwordSummary.map(item => (
                                    <tr key={item.level} className="bg-white border-b hover:bg-slate-50">
                                        <td className="px-4 py-3 font-medium text-slate-800">{item.program}</td>
                                        <td className="px-4 py-3">{item.level}</td>
                                        <td className="px-4 py-3"><code className="bg-slate-100 p-1 rounded-md text-sky-700 font-mono">{item.password}</code></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    );
};


const AssessmentScreen = ({ onNavigate, onStartAssessment }) => {
    return (
        <div className="p-4 md:p-8 animate-fade-in">
            <h1 className="text-4xl font-bold text-slate-800 mb-2">Test di Autovalutazione</h1>
            <p className="text-xl text-slate-600 mb-8">Scegli un'area da analizzare per iniziare.</p>
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {Object.values(assessmentsData).map(assessment => (
                    <div
                        key={assessment.id}
                        onClick={() => onStartAssessment(assessment.id)}
                        className="bg-white rounded-xl shadow-md p-6 flex flex-col items-start cursor-pointer hover:shadow-xl hover:scale-105 transition-all duration-300 animate-slide-in-up"
                    >
                        <div className="p-3 bg-sky-100 rounded-full mb-4">
                            <assessment.Icon className="w-8 h-8 text-sky-600" />
                        </div>
                        <h2 className="text-xl font-bold text-slate-800">{assessment.title}</h2>
                        <p className="text-slate-500 mt-2">Valuta la tua situazione attuale in quest'area.</p>
                    </div>
                ))}
            </div>
        </div>
    );
};

// HRV Analysis Logic
const getHrvInterpretation = (lf, hf) => {
    if (lf >= 5000 && lf <= 10000 && hf >= 1101 && hf <= 10000) return { label: "Individui sani o atleti in stato attivo", status: "OK", color: "#22c55e", zone: "ANS High Performance" }; // green-500
    if (lf > 500 && lf <= 10000 && hf >= 150 && hf <= 10000) return { label: "Normotonia", status: "OK", color: "#D87404", zone: "ANS Balanced" };
    if (lf >= 1 && lf <= 10 && hf >= 100 && hf <= 10000) return { label: "Profonda condizione di relax o inibizione SNS", status: "OK", color: "#D87404", zone: "PNS High, SNS Low" };
    if (lf > 10 && lf <= 500 && hf >= 1101 && hf <= 10000) return { label: "Relax psicofisico", status: "OK", color: "#D87404", zone: "PNS High, SNS Low" };
    if (lf >= 100 && lf <= 500 && hf >= 100 && hf <= 300) return { label: "ANS Balanced", status: "OK", color: "#D87404", zone: "Normotonia" };
    
    if (lf >= 1 && lf <= 10 && hf >= 7 && hf <= 99) return { label: "Aging, fatica cronica, indebolimento SNS", status: "NO", color: "#ef4444", zone: "SNS Low, PNS Low" }; // red-500
    if (lf >= 1 && lf <= 10 && hf >= 1 && hf <= 7) return { label: "Total hypotonia, stress cronico, esaurimento energetico", status: "NO", color: "#ef4444", zone: "ANS Low Hypotonia" };
    if (lf > 10 && lf <= 500 && hf > 300 && hf <= 1100) return { label: "Lieve ipertono vagale", status: "NO", color: "#ef4444", zone: "PNS High" };
    if (lf > 500 && lf <= 2000 && hf >= 96 && hf <= 149) return { label: "Impegno del sistema ortosimpatico", status: "NO", color: "#ef4444", zone: "SNS High" };
    if (lf > 2000 && lf <= 4000 && hf >= 96 && hf <= 149) return { label: "Netta prevalenza del tono simpatico", status: "NO", color: "#ef4444", zone: "SNS High" };
    if (lf > 4000 && lf <= 10000 && hf >= 96 && hf <= 149) return { label: "Stress da impegno ortosimpatico", status: "NO", color: "#ef4444", zone: "SNS High" };
    if (lf > 100 && lf <= 10000 && hf > 7 && hf <= 95) return { label: "Stress fisico o mentale, problemi acuti", status: "NO", color: "#ef4444", zone: "SNS High, PNS Low" };
    if (lf > 100 && lf <= 10000 && hf >= 1 && hf <= 7) return { label: "Stress estremo: infezioni, intossicazioni", status: "NO", color: "#ef4444", zone: "SNS High, PNS Low" };

    return { label: "Valori non classificati. Controllare i dati inseriti.", status: "INFO", color: "#6b7280", zone: "N/A" }; // gray-500
};

const HRVChart = ({ lf, hf }) => {
    const width = 350;
    const height = 350;
    const padding = 50;
    const chartSize = width - padding;
    const minVal = 1;
    const maxVal = 10000;

    const logPosition = (value) => {
        if (value < minVal) value = minVal;
        if (value > maxVal) value = maxVal;
        const scale = Math.log10(value) / Math.log10(maxVal);
        return scale * chartSize;
    };

    const pointX = logPosition(lf) + padding;
    const pointY = height - logPosition(hf);
    
    const zones = [
        { x: logPosition(1), y: logPosition(100), width: logPosition(100) - logPosition(1), height: logPosition(100) - logPosition(1), color: 'rgba(252, 211, 77, 0.2)', label: 'Ipotonia ANS' },
        { x: logPosition(500), y: logPosition(1), width: logPosition(10000) - logPosition(500), height: logPosition(150) - logPosition(1), color: 'rgba(96, 165, 250, 0.2)', label: 'Stress Simpatico' },
        { x: logPosition(1), y: logPosition(300), width: logPosition(500) - logPosition(1), height: logPosition(10000) - logPosition(300), color: 'rgba(56, 189, 248, 0.2)', label: 'Rilassamento' },
        { x: logPosition(1000), y: logPosition(500), width: logPosition(10000) - logPosition(1000), height: logPosition(10000) - logPosition(500), color: 'rgba(192, 132, 252, 0.2)', label: 'Alta Performance' },
        { x: logPosition(100), y: logPosition(100), width: logPosition(1000) - logPosition(100), height: logPosition(500) - logPosition(100), color: 'rgba(74, 222, 128, 0.2)', label: 'Equilibrio' },
    ];

    const axisLabels = [1, 10, 100, 1000, 10000];

    return (
        <div className="relative">
             <svg viewBox={`0 0 ${width + padding} ${height + padding}`} aria-label="Grafico a dispersione HRV">
                {/* Zones */}
                {zones.map(zone => (
                    <rect key={zone.label} x={zone.x + padding} y={height - zone.y - zone.height} width={zone.width} height={zone.height} fill={zone.color} />
                ))}

                {/* Grid lines */}
                {axisLabels.map(label => (
                    <g key={`grid-${label}`} className="text-slate-300">
                        <line x1={logPosition(label) + padding} y1={0} x2={logPosition(label) + padding} y2={height} stroke="currentColor" strokeDasharray="2,4"/>
                        <line x1={padding} y1={height - logPosition(label)} x2={width} y2={height - logPosition(label)} stroke="currentColor" strokeDasharray="2,4"/>
                    </g>
                ))}

                {/* Axes */}
                <line x1={padding} y1={height} x2={width} y2={height} stroke="#9ca3af" strokeWidth="1" />
                <line x1={padding} y1={0} x2={padding} y2={height} stroke="#9ca3af" strokeWidth="1" />
                
                {/* Axis Labels */}
                {axisLabels.map(label => (
                    <g key={`label-${label}`} className="text-xs text-slate-500 fill-current">
                        <text x={logPosition(label) + padding} y={height + 20} textAnchor="middle">{label}</text>
                        <text x={padding - 10} y={height - logPosition(label)} textAnchor="end" dominantBaseline="middle">{label}</text>
                    </g>
                ))}
                <text x={(width + padding)/2} y={height + 40} textAnchor="middle" className="font-semibold text-slate-600">LF Power (ms²)</text>
                <text transform={`translate(15, ${(height)/2}) rotate(-90)`} textAnchor="middle" className="font-semibold text-slate-600">HF Power (ms²)</text>

                {/* Data Point */}
                {lf > 0 && hf > 0 && (
                    <circle cx={pointX} cy={pointY} r="6" fill="#0ea5e9" stroke="white" strokeWidth="2" className="drop-shadow-lg" />
                )}
            </svg>
        </div>
    );
};

const BloodAnalysisScreen = ({ user }) => {
    const [lfPower, setLfPower] = React.useState('200');
    const [hfPower, setHfPower] = React.useState('200');
    const [analysisResult, setAnalysisResult] = React.useState(null);
    const [chartData, setChartData] = React.useState({ lf: 200, hf: 200 });

    const handleAnalyze = () => {
        const lf = parseFloat(lfPower);
        const hf = parseFloat(hfPower);
        if (!isNaN(lf) && !isNaN(hf) && lf > 0 && hf > 0) {
            const result = getHrvInterpretation(lf, hf);
            setAnalysisResult(result);
            setChartData({ lf, hf });
        } else {
            setAnalysisResult({ label: "Inserisci valori numerici validi e positivi per LF e HF.", status: "ERROR", color: "#ef4444", zone: "N/A" });
        }
    };

    React.useEffect(() => {
        // Run initial analysis on load with default values
        handleAnalyze();
    }, []);

    return (
        <div className="p-4 md:p-8 animate-fade-in">
            <h1 className="text-4xl font-bold text-slate-800 mb-2">Analisi HRV (Variabilità Cardiaca)</h1>
            <p className="text-xl text-slate-600 mb-8">Interpreta l'equilibrio del tuo sistema nervoso autonomo.</p>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div className="lg:col-span-1">
                    <div className="bg-white p-6 rounded-2xl shadow-lg sticky top-8">
                        <h2 className="text-2xl font-bold text-slate-700 mb-4">Inserisci i Dati</h2>
                        <div className="space-y-4">
                            <div>
                                <label htmlFor="lf-power" className="block text-sm font-medium text-slate-600 mb-1">LF Power (ms²)</label>
                                <input
                                    id="lf-power" type="number" value={lfPower} onChange={(e) => setLfPower(e.target.value)}
                                    className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                                    placeholder="e.g., 500"
                                />
                            </div>
                            <div>
                                <label htmlFor="hf-power" className="block text-sm font-medium text-slate-600 mb-1">HF Power (ms²)</label>
                                <input
                                    id="hf-power" type="number" value={hfPower} onChange={(e) => setHfPower(e.target.value)}
                                    className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                                    placeholder="e.g., 300"
                                />
                            </div>
                        </div>
                         <button
                            onClick={handleAnalyze}
                            className="w-full mt-6 bg-sky-600 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:bg-sky-700 focus:outline-none focus:shadow-outline transition-all duration-300 flex items-center justify-center gap-2"
                        >
                            <SparklesIcon className="w-5 h-5" />
                            <span>Analizza Ora</span>
                        </button>
                    </div>
                </div>
                <div className="lg:col-span-2">
                    <div className="bg-white p-6 rounded-2xl shadow-lg">
                        <h2 className="text-2xl font-bold text-slate-700 mb-2">Mappa del Sistema Nervoso Autonomo</h2>
                        <HRVChart lf={chartData.lf} hf={chartData.hf} />
                        {analysisResult && (
                            <div className="mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200">
                                <h3 className="text-xl font-bold text-slate-800 mb-3">Interpretazione Risultato</h3>
                                <div className={`flex items-start gap-4 p-4 rounded-md border-l-4`} style={{ borderColor: analysisResult.color, backgroundColor: `${analysisResult.color}1A` }}>
                                    <div className="flex-shrink-0">
                                        {analysisResult.status === 'OK' && <CheckCircleIcon className="w-8 h-8" style={{ color: analysisResult.color }} />}
                                        {analysisResult.status === 'NO' && <XCircleIcon className="w-8 h-8" style={{ color: analysisResult.color }} />}
                                        {analysisResult.status === 'INFO' && <BeakerIcon className="w-8 h-8" style={{ color: analysisResult.color }} />}
                                        {analysisResult.status === 'ERROR' && <XCircleIcon className="w-8 h-8" style={{ color: analysisResult.color }} />}
                                    </div>
                                    <div>
                                        <p className="font-semibold text-lg" style={{ color: analysisResult.color }}>{analysisResult.label}</p>
                                        <p className="text-sm text-slate-600 mt-1">Zona ANS: <span className="font-medium">{analysisResult.zone}</span></p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            </div>
        </div>
    );
};


const PrescriptionScreen = ({ user, showNotification }) => {
    const [prescriptions, setPrescriptions] = React.useState([]);
    const [selectedFile, setSelectedFile] = React.useState(null);

    React.useEffect(() => {
        const storedPrescriptions = JSON.parse(localStorage.getItem(`prescriptions_${user.email}`) || '[]');
        setPrescriptions(storedPrescriptions);
    }, [user.email]);

    const savePrescriptions = (updatedPrescriptions) => {
        setPrescriptions(updatedPrescriptions);
        localStorage.setItem(`prescriptions_${user.email}`, JSON.stringify(updatedPrescriptions));
    };

    const handleFileChange = (event) => {
        if (event.target.files && event.target.files[0]) {
            setSelectedFile(event.target.files[0]);
        }
    };
    
    const handleAddToList = () => {
        if (!selectedFile) {
            alert("Per favore, seleziona un file prima di aggiungerlo.");
            return;
        }
        
        const newPrescription = {
            id: Date.now().toString(),
            fileName: selectedFile.name,
            dateAdded: new Date().toISOString(),
        };

        savePrescriptions([...prescriptions, newPrescription]);
        
        // Reset file input
        setSelectedFile(null);
        const fileInput = document.getElementById('prescription-upload');
        if (fileInput instanceof HTMLInputElement) {
            fileInput.value = '';
        }
    };

    const handleSendEmail = (prescription) => {
        const subject = `Invio Ricetta Medica - ${prescription.fileName}`;
        const body = `Buongiorno,\n\nIn allegato la ricetta medica "${prescription.fileName}" per ${user.name}.\n\n(Ricorda di allegare manualmente il file prima di inviare)\n\nGrazie,\n${user.name}`;

        const mailtoLink = `mailto:${PHARMACY_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.open(mailtoLink, '_blank');
    };

    const handleSendWhatsApp = (prescription) => {
        const message = `Buongiorno, vorrei inviare la ricetta "${prescription.fileName}" per ${user.name}. Allego il file qui di seguito. Grazie.`;
        const whatsappLink = `https://wa.me/${PHARMACY_WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
        window.open(whatsappLink, '_blank');
    };
    
    const handleDelete = (id) => {
        if (confirm("Sei sicuro di voler eliminare questa ricetta dalla lista?")) {
            const updatedPrescriptions = prescriptions.filter(p => p.id !== id);
            savePrescriptions(updatedPrescriptions);
            showNotification('Ricetta eliminata con successo', 'success');
        }
    }

    return (
        <div className="p-4 md:p-8 animate-fade-in">
            <h1 className="text-4xl font-bold text-slate-800 mb-8">Invio Ricette Mediche</h1>
            
            <div className="bg-white p-6 rounded-2xl shadow-lg mb-8">
                <h2 className="text-2xl font-bold text-slate-700 mb-4">1. Carica la tua ricetta</h2>
                <div className="flex flex-col sm:flex-row items-center gap-4">
                    <label htmlFor="prescription-upload" className="w-full sm:w-auto flex-grow cursor-pointer bg-slate-100 border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:bg-slate-200 hover:border-slate-400 transition-colors">
                        {selectedFile ? (
                             <span className="text-green-600 font-semibold">{selectedFile.name}</span>
                        ) : (
                            <span className="text-slate-500">Clicca qui per selezionare un file (PDF, JPG, PNG)</span>
                        )}
                    </label>
                    <input id="prescription-upload" type="file" className="hidden" onChange={handleFileChange} accept=".pdf,.jpg,.jpeg,.png"/>
                    <button 
                        onClick={handleAddToList}
                        disabled={!selectedFile}
                        className="w-full sm:w-auto px-6 py-3 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 transition-colors shadow-md disabled:bg-slate-400 disabled:cursor-not-allowed"
                    >
                        Aggiungi Ricetta alla Lista
                    </button>
                </div>
            </div>

            <div className="bg-white p-6 rounded-2xl shadow-lg">
                <h2 className="text-2xl font-bold text-slate-700 mb-4">2. Le Tue Ricette da Inviare</h2>
                 {prescriptions.length > 0 ? (
                    <ul className="space-y-3">
                        {prescriptions.map(p => (
                            <li key={p.id} className="bg-slate-50 p-4 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
                                <div className="flex-grow">
                                    <p className="font-bold text-slate-800">{p.fileName}</p>
                                    <p className="text-sm text-slate-500">Aggiunta il: {new Date(p.dateAdded).toLocaleString('it-IT')}</p>
                                </div>
                                <div className="flex items-center gap-2 self-end sm:self-center">
                                    <button 
                                        onClick={() => handleSendEmail(p)}
                                        className="px-4 py-2 bg-sky-600 text-white text-sm font-semibold rounded-lg hover:bg-sky-700 transition-colors flex items-center gap-1.5"
                                    >
                                        <MailIcon className="w-4 h-4" />
                                        <span>Email</span>
                                    </button>
                                    <button 
                                        onClick={() => handleSendWhatsApp(p)}
                                        className="px-4 py-2 bg-green-500 text-white text-sm font-semibold rounded-lg hover:bg-green-600 transition-colors flex items-center gap-1.5"
                                    >
                                        <WhatsAppIcon className="w-4 h-4" />
                                        <span>WhatsApp</span>
                                    </button>
                                     <button 
                                        onClick={() => handleDelete(p.id)}
                                        className="px-4 py-2 bg-red-500 text-white text-sm font-semibold rounded-lg hover:bg-red-600 transition-colors"
                                    >
                                        Elimina
                                    </button>
                                </div>
                            </li>
                        ))}
                    </ul>
                ) : (
                    <p className="text-center text-slate-500 py-8">Non hai ancora aggiunto nessuna ricetta.</p>
                )}
            </div>
        </div>
    );
};

const SelectionSummary = ({ selection, onProceed }) => {
    // Helper function to parse duration strings like "50 min" or "1h 15 min" into total minutes
    const parseDurationInMinutes = (durationStr) => {
        if (!durationStr) return 0;
        let totalMinutes = 0;
        const parts = durationStr.split(' ');
        
        for (let i = 0; i < parts.length; i++) {
            if (parts[i].includes('h')) {
                totalMinutes += parseInt(parts[i], 10) * 60;
            } else if (parts[i].includes('min')) {
                totalMinutes += parseInt(parts[i], 10);
            }
        }
        return totalMinutes;
    };

    // Helper function to format total minutes back into a readable string
    const formatMinutes = (totalMinutes) => {
        if (totalMinutes === 0) return '0 min';
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;
        let result = '';
        if (hours > 0) {
            result += `${hours}h `;
        }
        if (minutes > 0) {
            result += `${minutes}min`;
        }
        return result.trim();
    };

    const totalPrice = selection.reduce((acc, item) => acc + item.price, 0);
    const totalDurationInMinutes = selection.reduce((acc, item) => acc + parseDurationInMinutes(item.duration), 0);
    const formattedTotalDuration = formatMinutes(totalDurationInMinutes);


    return (
        <div className="fixed bottom-0 left-0 right-0 md:left-64 bg-slate-800 text-white p-4 shadow-[0_-4px_15px_-5px_rgba(0,0,0,0.2)] z-20 animate-slide-in-bottom">
            <div className="max-w-7xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
                <div className="flex-grow text-center sm:text-left">
                    <h3 className="font-bold text-lg">{selection.length} Servizi Selezionati</h3>
                    <div className="flex gap-4 text-sky-200 text-sm">
                        <span>Durata Totale: <span className="font-semibold text-white">{formattedTotalDuration}</span></span>
                        <span>Costo Totale: <span className="font-semibold text-white">{totalPrice}€</span></span>
                    </div>
                </div>
                <div className="flex items-center gap-2">
                     <button onClick={onProceed} className="bg-sky-500 font-semibold py-2 px-6 rounded-lg hover:bg-sky-600 transition-colors flex items-center justify-center gap-2">
                        <span>Richiedi Appuntamento</span>
                    </button>
                </div>
            </div>
        </div>
    );
};

const BookingModal = ({ isOpen, onClose, selection, user, onConfirmByEmail, onConfirmByWhatsApp }) => {
    if (!isOpen) return null;

    const [date, setDate] = React.useState('');
    const [time, setTime] = React.useState('');
    const [error, setError] = React.useState('');
    const today = new Date().toISOString().split('T')[0];

    const handleConfirm = (method) => {
        setError('');
        if (!date || !time) {
            setError("Per favore, seleziona sia una data che un orario.");
            return;
        }
        if (date < today) {
            setError("La data selezionata non può essere nel passato.");
            return;
        }
        
        if (method === 'email') {
            onConfirmByEmail(date, time);
        } else if (method === 'whatsapp') {
            onConfirmByWhatsApp(date, time);
        }
    };

    const totalPrice = selection.reduce((acc, item) => acc + item.price, 0);
    
    return (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in">
            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg transform transition-transform animate-slide-in-up">
                <div className="flex justify-between items-center p-5 border-b border-slate-200">
                    <h2 className="text-2xl font-bold text-slate-800">Completa la tua Richiesta</h2>
                    <button onClick={onClose} className="text-slate-400 hover:text-slate-600">
                        <XIcon className="w-6 h-6" />
                    </button>
                </div>
                <div className="p-6">
                    <div className="mb-6">
                        <h3 className="font-semibold text-slate-700 mb-2">Riepilogo Servizi:</h3>
                        <ul className="space-y-1 text-slate-600 max-h-32 overflow-y-auto bg-slate-50 p-3 rounded-md">
                            {selection.map(item => <li key={item.id}>- {item.name}</li>)}
                        </ul>
                        <p className="text-right font-bold text-slate-800 mt-2">Totale: {totalPrice}€</p>
                    </div>

                    <div>
                        <h3 className="font-semibold text-slate-700 mb-3">Scegli la tua preferenza di appuntamento:</h3>
                        {error && (
                            <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-3 mb-4 rounded-md" role="alert">
                                <p>{error}</p>
                            </div>
                        )}
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label htmlFor="booking-date" className="block text-sm font-medium text-slate-600 mb-1">Data</label>
                                <input 
                                    type="date" 
                                    id="booking-date"
                                    min={today}
                                    value={date}
                                    onChange={e => setDate(e.target.value)}
                                    className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                                />
                            </div>
                            <div>
                                <label htmlFor="booking-time" className="block text-sm font-medium text-slate-600 mb-1">Orario</label>
                                <input 
                                    type="time" 
                                    id="booking-time"
                                    value={time}
                                    onChange={e => setTime(e.target.value)}
                                    className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                                />
                            </div>
                        </div>
                    </div>
                </div>
                <div className="bg-slate-50 p-5 rounded-b-2xl flex flex-col sm:flex-row justify-end items-center gap-3">
                     <button onClick={() => handleConfirm('email')} className="w-full sm:w-auto px-5 py-2 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 transition-colors flex items-center justify-center gap-2">
                         <MailIcon className="w-5 h-5" />
                         Invia via Email
                    </button>
                    <button onClick={() => handleConfirm('whatsapp')} className="w-full sm:w-auto px-5 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center gap-2">
                         <WhatsAppIcon className="w-5 h-5" />
                         Invia via WhatsApp
                    </button>
                </div>
            </div>
        </div>
    );
};


const TreatmentsScreen = ({ user, showNotification }) => {
    const [activeTab, setActiveTab] = React.useState('programs');
    const [openCategory, setOpenCategory] = React.useState(wellnessData.treatments[0].category);
    const [selection, setSelection] = React.useState([]);
    const [isBookingModalOpen, setIsBookingModalOpen] = React.useState(false);
    const [bookingHistory, setBookingHistory] = React.useState([]);

    React.useEffect(() => {
        const allBookings = JSON.parse(localStorage.getItem('spaBookings') || '[]');
        const userHistory = allBookings.filter(b => b.userEmail === user.email);
        setBookingHistory(userHistory.sort((a, b) => new Date(b.dateSubmitted).getTime() - new Date(a.dateSubmitted).getTime()));
    }, [user.email]);

    const handleSelectOption = (item, option) => {
        const selectionId = `${item.name}-${option.type}`;
        const isAlreadySelected = selection.some(s => s.id === selectionId);
        const filteredSelection = selection.filter(s => s.baseName !== item.name);

        if (isAlreadySelected) {
            setSelection(filteredSelection);
        } else {
            const newItem = {
                id: selectionId,
                baseName: item.name,
                name: option.name,
                duration: option.duration,
                price: option.price,
            };
            setSelection([...filteredSelection, newItem]);
        }
    };
    
    const createBookingRequest = (date, time, method) => {
        const newBooking = {
            id: Date.now().toString(),
            userEmail: user.email,
            userName: user.name,
            services: selection,
            requestedDate: date,
            requestedTime: time,
            totalPrice: selection.reduce((acc, item) => acc + item.price, 0),
            status: 'pending',
            dateSubmitted: new Date().toISOString()
        };

        const allBookings = JSON.parse(localStorage.getItem('spaBookings') || '[]');
        localStorage.setItem('spaBookings', JSON.stringify([...allBookings, newBooking]));
        setBookingHistory(prev => [...prev, newBooking].sort((a, b) => new Date(b.dateSubmitted).getTime() - new Date(a.dateSubmitted).getTime()));


        const servicesText = selection.map(s => `- ${s.name}`).join('\n');
        const details = `
Richiesta di prenotazione da: ${user.name} (${user.email})
Data richiesta: ${new Date(date).toLocaleDateString('it-IT')}
Ora richiesta: ${time}

Servizi:
${servicesText}

Totale: ${newBooking.totalPrice}€
        `.trim();

        if (method === 'email') {
            const subject = `Richiesta di Prenotazione - ${user.name}`;
            const mailtoLink = `mailto:${PHARMACY_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(details)}`;
            window.open(mailtoLink, '_blank');
        } else if (method === 'whatsapp') {
            const whatsappLink = `https://wa.me/${PHARMACY_WHATSAPP_NUMBER}?text=${encodeURIComponent(details)}`;
            window.open(whatsappLink, '_blank');
        }
        
        setIsBookingModalOpen(false);
        setSelection([]);
        showNotification('La tua richiesta è pronta per essere inviata!');
    };
    
    const OptionButton = ({ text, isSelected, onClick }) => (
        <button
            onClick={onClick}
            className={`text-xs font-semibold px-3 py-1.5 rounded-full flex items-center justify-center gap-1.5 transition-colors border ${
                isSelected 
                ? 'bg-sky-500 text-white border-sky-500' 
                : 'bg-sky-50 text-sky-800 border-sky-200 hover:bg-sky-100 hover:border-sky-300'
            }`}
        >
            {text}
        </button>
    );

    const StatusChip = ({ status }) => {
        const styles = {
            pending: 'bg-yellow-100 text-yellow-800',
            confirmed: 'bg-green-100 text-green-800',
            rejected: 'bg-red-100 text-red-800',
        };
        const text = {
            pending: 'In attesa di conferma',
            confirmed: 'Confermata',
            rejected: 'Rifiutata',
        };
        return <span className={`px-3 py-1 text-sm font-bold rounded-full ${styles[status] || 'bg-gray-100 text-gray-800'}`}>{text[status] || 'Sconosciuto'}</span>;
    };
    
    const renderItems = (items) => (
        items.map(item => {
            const selectedOption = selection.find(s => s.baseName === item.name);

            return (
                <div key={item.name} className="py-4 flex flex-col md:flex-row md:items-start justify-between gap-4">
                    <div className="flex-grow">
                        <h4 className="text-lg font-semibold text-slate-700">{item.name}</h4>
                        {item.description && <p className="text-slate-600 mt-1 mb-2 text-sm">{item.description}</p>}
                        
                        <div className="flex flex-wrap gap-2 mt-3">
                            {item.price && (
                                <OptionButton 
                                    text={`Singola: ${item.price}€`}
                                    isSelected={selectedOption?.id === `${item.name}-single`}
                                    onClick={() => handleSelectOption(item, {
                                        type: 'single',
                                        name: item.name,
                                        duration: item.duration,
                                        price: item.price
                                    })}
                                />
                            )}
                            {item.basePrice && (
                                <OptionButton 
                                    text={`Base: ${item.basePrice}€`}
                                    isSelected={selectedOption?.id === `${item.name}-base`}
                                    onClick={() => handleSelectOption(item, {
                                        type: 'base',
                                        name: `${item.name} (Base)`,
                                        duration: item.baseDuration,
                                        price: item.basePrice
                                    })}
                                />
                            )}
                             {item.photoPrice && (
                                <OptionButton 
                                    text={`+ Foto: ${item.photoPrice}€`}
                                    isSelected={selectedOption?.id === `${item.name}-photo`}
                                    onClick={() => handleSelectOption(item, {
                                        type: 'photo',
                                        name: `${item.name} (con Fotostimolazione)`,
                                        duration: item.photoDuration,
                                        price: item.photoPrice
                                    })}
                                />
                            )}
                            {item.package4 && (
                                <OptionButton 
                                    text={`4 sedute: ${item.package4}€`}
                                    isSelected={selectedOption?.id === `${item.name}-p4`}
                                    onClick={() => handleSelectOption(item, {
                                        type: 'p4',
                                        name: `${item.name} (Pacchetto 4 sedute)`,
                                        duration: null,
                                        price: item.package4
                                    })}
                                />
                            )}
                            {item.package6 && (
                                <OptionButton 
                                    text={`6 sedute: ${item.package6}€`}
                                    isSelected={selectedOption?.id === `${item.name}-p6`}
                                    onClick={() => handleSelectOption(item, {
                                        type: 'p6',
                                        name: `${item.name} (Pacchetto 6 sedute)`,
                                        duration: null,
                                        price: item.package6
                                    })}
                                />
                            )}
                             {item.package10 && (
                                <OptionButton 
                                    text={`10 sedute: ${item.package10}€`}
                                    isSelected={selectedOption?.id === `${item.name}-p10`}
                                    onClick={() => handleSelectOption(item, {
                                        type: 'p10',
                                        name: `${item.name} (Pacchetto 10 sedute)`,
                                        duration: null,
                                        price: item.package10
                                    })}
                                />
                            )}
                        </div>
                    </div>
                </div>
            );
        })
    );

    return (
        <div className="p-4 md:p-8 animate-fade-in pb-32">
            <h1 className="text-4xl font-bold text-slate-800 mb-2">Programmi & Trattamenti</h1>
            <p className="text-xl text-slate-600 mb-8">Componi il percorso benessere perfetto per te.</p>
            
            <div className="border-b border-gray-200 mb-6">
                <nav className="-mb-px flex space-x-6" aria-label="Tabs">
                    <button onClick={() => setActiveTab('programs')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg ${activeTab === 'programs' ? 'border-sky-500 text-sky-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>
                        Programmi SPA
                    </button>
                    <button onClick={() => setActiveTab('treatments')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg ${activeTab === 'treatments' ? 'border-sky-500 text-sky-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>
                        Trattamenti Singoli
                    </button>
                </nav>
            </div>
            
            {activeTab === 'programs' && (
                 <div className="space-y-4 animate-fade-in">
                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div className="p-4 divide-y divide-slate-100">
                           {renderItems(wellnessData.programs)}
                        </div>
                    </div>
                </div>
            )}
            
            {activeTab === 'treatments' && (
                <div className="space-y-4 animate-fade-in">
                    {wellnessData.treatments.map(category => (
                        <div key={category.category} className="bg-white rounded-xl shadow-lg overflow-hidden">
                            <button onClick={() => setOpenCategory(openCategory === category.category ? null : category.category)} className="w-full text-left p-4 flex justify-between items-center bg-slate-50 hover:bg-slate-100">
                                <h3 className="text-xl font-bold text-slate-800">{category.category}</h3>
                                <svg className={`w-6 h-6 text-slate-500 transition-transform ${openCategory === category.category ? 'transform rotate-180' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" /></svg>
                            </button>
                            {openCategory === category.category && (
                                <div className="p-4 divide-y divide-slate-100">
                                    {renderItems(category.items)}
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            )}
            
            <div className="mt-12">
                <h2 className="text-3xl font-bold text-slate-800 mb-6">Le Tue Richieste di Prenotazione</h2>
                <div className="bg-white p-6 rounded-2xl shadow-lg">
                    {bookingHistory.length > 0 ? (
                        <ul className="space-y-4">
                            {bookingHistory.map(booking => (
                                <li key={booking.id} className="bg-slate-50 p-4 rounded-lg">
                                    <div className="flex flex-col sm:flex-row justify-between items-start gap-4">
                                        <div>
                                            <p className="font-bold text-slate-800">
                                                Richiesta per il {new Date(booking.requestedDate).toLocaleDateString('it-IT', { day: '2-digit', month: 'long', year: 'numeric' })} alle {booking.requestedTime}
                                            </p>
                                            <p className="text-xs text-slate-500 mt-1">
                                                Inviata il: {new Date(booking.dateSubmitted).toLocaleString('it-IT')}
                                            </p>
                                        </div>
                                        <div className="self-start sm:self-center flex-shrink-0">
                                            <StatusChip status={booking.status} />
                                        </div>
                                    </div>
                                    <div className="mt-4 border-t border-slate-200 pt-3">
                                        <h4 className="font-semibold text-slate-700 mb-2">Servizi Richiesti:</h4>
                                        <ul className="list-disc list-inside text-slate-600 text-sm space-y-1">
                                            {booking.services.map(service => (
                                                <li key={service.id}>{service.name}</li>
                                            ))}
                                        </ul>
                                        <p className="text-right font-bold text-slate-800 mt-3">
                                            Totale: {booking.totalPrice}€
                                        </p>
                                    </div>
                                </li>
                            ))}
                        </ul>
                    ) : (
                        <p className="text-center text-slate-500 py-8">Non hai ancora inviato richieste di prenotazione.</p>
                    )}
                </div>
            </div>

            {selection.length > 0 && 
                <SelectionSummary 
                    selection={selection} 
                    onProceed={() => setIsBookingModalOpen(true)}
                />
            }

            <BookingModal
                isOpen={isBookingModalOpen}
                onClose={() => setIsBookingModalOpen(false)}
                selection={selection}
                user={user}
                onConfirmByEmail={(date, time) => createBookingRequest(date, time, 'email')}
                onConfirmByWhatsApp={(date, time) => createBookingRequest(date, time, 'whatsapp')}
            />
        </div>
    );
};

const WellnessRoutineScreen = ({ user, showNotification }) => {
    const [selectedProgramId, setSelectedProgramId] = React.useState(null);
    const [activeReminders, setActiveReminders] = React.useState(new Set());
    const reminderTimers = React.useRef({});

    const program = selectedProgramId ? wellnessProgramsData[selectedProgramId] : null;
    
    const numWeeksForProgram = program?.numWeeks || 10;
    const weeks = Array.from({ length: numWeeksForProgram }, (_, i) => ({ value: `Settimana ${i + 1}`, label: `${i + 1}ª settimana` }));
    const daysOfWeek = ['Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato', 'Domenica'];

    const getCurrentDayName = () => {
        const dayIndex = new Date().getDay();
        return daysOfWeek[(dayIndex + 6) % 7]; // 0 is Sunday, make it last
    };
    
    const [selectedDay, setSelectedDay] = React.useState(getCurrentDayName);
    const [selectedWeek, setSelectedWeek] = React.useState(weeks[0].value);
    const [missionsData, setMissionsData] = React.useState({ daily: {}, weekly: {} });

    const storageKey = selectedProgramId ? `wellnessRoutine_${user.email}_${selectedProgramId}` : null;
    const remindersStorageKey = `activeReminders_${user.email}`;

    React.useEffect(() => {
        const storedReminders = JSON.parse(localStorage.getItem(remindersStorageKey) || '[]');
        setActiveReminders(new Set(storedReminders));
    }, [remindersStorageKey]);

    const showReminder = (title, options) => {
        if (Notification.permission === 'granted') {
            // In a real PWA, you would use serviceWorker.registration.showNotification
            new Notification(title, options);
        }
    };

    React.useEffect(() => {
        // Clear all previous timers
        Object.values(reminderTimers.current).forEach(timerId => {
            clearInterval(timerId);
            clearTimeout(timerId);
        });
        reminderTimers.current = {};

        activeReminders.forEach(missionId => {
            const mission = Object.values(wellnessProgramsData)
                .flatMap(p => [...(p.daily || []), ...(p.weekly || [])])
                .find(m => m.id === missionId);

            if (mission && mission.remindable) {
                const { type, time, hours, startHour, endHour } = mission.reminderConfig;
                if (type === 'daily' && time) {
                    const [hour, minute] = time.split(':').map(Number);
                    
                    const scheduleDaily = () => {
                        const now = new Date();
                        const reminderTime = new Date();
                        reminderTime.setHours(hour, minute, 0, 0);

                        if (now > reminderTime) {
                           reminderTime.setDate(reminderTime.getDate() + 1);
                        }
                        
                        const timeout = reminderTime.getTime() - now.getTime();
                        
                        reminderTimers.current[missionId] = setTimeout(() => {
                            showReminder('Promemoria Benessere', { body: `È ora di: ${mission.title}!` });
                            scheduleDaily(); // Reschedule for the next day
                        }, timeout);
                    };
                    scheduleDaily();

                } else if (type === 'interval' && hours) {
                    reminderTimers.current[missionId] = setInterval(() => {
                        const currentHour = new Date().getHours();
                        if (currentHour >= startHour && currentHour <= endHour) {
                            showReminder('Promemoria Benessere', { body: `Ricorda di: ${mission.title}!` });
                        }
                    }, hours * 60 * 60 * 1000);
                }
            }
        });

        // Cleanup function
        return () => {
            Object.values(reminderTimers.current).forEach(timerId => {
                clearInterval(timerId);
                clearTimeout(timerId);
            });
        };
    }, [activeReminders]);

    React.useEffect(() => {
        if (!storageKey || !program) return;

        let data = JSON.parse(localStorage.getItem(storageKey));
        
        if (!data || typeof data.daily !== 'object' || typeof data.weekly !== 'object') {
            data = { daily: {}, weekly: {} };
        }

        const dailySets = {};
        daysOfWeek.forEach(day => {
            dailySets[day] = new Set(data.daily?.[day] || []);
        });
        
        const weeklySets = {};
        weeks.forEach(week => {
             weeklySets[week.value] = new Set(data.weekly?.[week.value] || []);
        });

        setMissionsData({
            daily: dailySets,
            weekly: weeklySets,
        });
    }, [user.email, program, storageKey]);

    const handleToggleMission = React.useCallback((mission, type) => {
        if (!storageKey) return;

        setMissionsData(prevData => {
            let updatedData;
            
            if (type === 'daily') {
                const dayMissions = prevData.daily[selectedDay] || new Set();
                const newDayMissions = new Set(dayMissions);
                if (newDayMissions.has(mission.id)) {
                    newDayMissions.delete(mission.id);
                } else {
                    newDayMissions.add(mission.id);
                }
                updatedData = { ...prevData, daily: { ...prevData.daily, [selectedDay]: newDayMissions } };
            } else { // weekly
                const weekMissions = prevData.weekly[selectedWeek] || new Set();
                const newWeekMissions = new Set(weekMissions);
                if (newWeekMissions.has(mission.id)) {
                    newWeekMissions.delete(mission.id);
                } else {
                    newWeekMissions.add(mission.id);
                }
                updatedData = { ...prevData, weekly: { ...prevData.weekly, [selectedWeek]: newWeekMissions } };
            }
            
            const dailyArrays = {};
            Object.keys(updatedData.daily).forEach(d => { dailyArrays[d] = Array.from(updatedData.daily[d]); });
            
            const weeklyArrays = {};
            Object.keys(updatedData.weekly).forEach(w => { weeklyArrays[w] = Array.from(updatedData.weekly[w]); });

            const dataToStore = { daily: dailyArrays, weekly: weeklyArrays };
            
            if (program && !program.isSmart) {
                localStorage.setItem(storageKey, JSON.stringify(dataToStore));
            }
            
            return updatedData;
        });
    }, [storageKey, selectedDay, selectedWeek, program]);
    
    const handleToggleReminder = React.useCallback(async (missionId) => {
        if (!('Notification' in window) || typeof Notification.requestPermission !== 'function') {
            showNotification("Usa un server (HTTPS) per abilitare le notifiche.", 'error');
            return;
        }

        const toggle = () => {
            setActiveReminders(prev => {
                const newReminders = new Set(prev);
                if (newReminders.has(missionId)) {
                    newReminders.delete(missionId);
                } else {
                    newReminders.add(missionId);
                }
                localStorage.setItem(remindersStorageKey, JSON.stringify(Array.from(newReminders)));
                return newReminders;
            });
        };

        let permission = Notification.permission;

        if (permission === 'default') {
            try {
                permission = await Notification.requestPermission();
            } catch (error) {
                console.error("Errore durante la richiesta dei permessi di notifica:", error);
                showNotification("Errore richiedendo i permessi per le notifiche.", 'error');
                return;
            }
        }

        if (permission === 'granted') {
            toggle();
        } else {
            showNotification('Permesso notifiche negato. Controlla le impostazioni del browser.', 'error');
        }
    }, [remindersStorageKey, showNotification]);

    const { dailyScore, dailyMax, dailyProgress, weeklyScore, weeklyMax, weeklyProgress } = React.useMemo(() => {
        if (!program) {
            return { dailyScore: 0, dailyMax: 0, dailyProgress: 0, weeklyScore: 0, weeklyMax: 0, weeklyProgress: 0 };
        }

        const selectedDayMissions = missionsData.daily[selectedDay] || new Set();
        const daily = (program.daily || []).reduce((acc, mission) => {
            if (selectedDayMissions.has(mission.id)) acc.score += mission.points;
            acc.max += mission.points;
            return acc;
        }, { score: 0, max: 0 });
        
        const selectedWeekMissions = missionsData.weekly[selectedWeek] || new Set();
        const weekly = (program.weekly || []).reduce((acc, mission) => {
            if (selectedWeekMissions.has(mission.id)) acc.score += mission.points;
            acc.max += mission.points;
            return acc;
        }, { score: 0, max: 0 });

        return {
            dailyScore: daily.score, dailyMax: daily.max, dailyProgress: daily.max > 0 ? (daily.score / daily.max) * 100 : 0,
            weeklyScore: weekly.score, weeklyMax: weekly.max, weeklyProgress: weekly.max > 0 ? (weekly.score / weekly.max) * 100 : 0,
        };
    }, [missionsData, program, selectedDay, selectedWeek]);


    if (!program) {
        const startProgram = wellnessProgramsData.start;
        const foodPrograms = Object.values(wellnessProgramsData).filter(p => p.id.startsWith('food_'));
        const sleepPrograms = Object.values(wellnessProgramsData).filter(p => p.id.startsWith('sleep_') && !p.id.startsWith('sleep_old'));
        const anxietyPrograms = Object.values(wellnessProgramsData).filter(p => p.id.startsWith('anxiety_'));
        const activityPrograms = Object.values(wellnessProgramsData).filter(p => p.id.startsWith('activity_'));
        const otherPrograms = Object.values(wellnessProgramsData).filter(p => p.isSmart);

        const calculateTotalScore = (programId) => {
            const key = `wellnessRoutine_${user.email}_${programId}`;
            const programData = wellnessProgramsData[programId];
            if (!programData) return 0;
        
            const storedProgress = JSON.parse(localStorage.getItem(key) || '{}');
            let totalScore = 0;
        
            const allMissions = [...(programData.daily || []), ...(programData.weekly || [])];
            const missionPointsMap = allMissions.reduce((map, mission) => {
                map[mission.id] = mission.points;
                return map;
            }, {});

            if (storedProgress.daily) {
                Object.values(storedProgress.daily).forEach(dayMissions => {
                    dayMissions.forEach(missionId => {
                        if (missionPointsMap[missionId]) totalScore += missionPointsMap[missionId];
                    });
                });
            }
            if (storedProgress.weekly) {
                 Object.values(storedProgress.weekly).forEach(weekMissions => {
                    weekMissions.forEach(missionId => {
                        if (missionPointsMap[missionId]) totalScore += missionPointsMap[missionId];
                    });
                });
            }
            return totalScore;
        };

        const programScores = [...foodPrograms, ...anxietyPrograms, ...activityPrograms, ...sleepPrograms].reduce((acc, p) => {
            if (p.id) {
                acc[p.id] = calculateTotalScore(p.id);
            }
            return acc;
        }, {});

        const manualUnlocks = JSON.parse(localStorage.getItem(`manualUnlocks_${user.email}`) || '[]');

        const ProgramSection = ({ title, programs, icon }) => (
            <>
                <div className="relative my-10 text-center">
                    <div className="absolute inset-0 flex items-center" aria-hidden="true"><div className="w-full border-t border-slate-300"></div></div>
                    <div className="relative flex justify-center"><span className="bg-slate-50 px-4 text-xl font-bold text-slate-700">{icon} {title}</span></div>
                </div>
                <div className="space-y-6 mb-10">
                    {programs.map(p => {
                        const previousLevelScore = p.dependsOn ? programScores[p.dependsOn] : 0;
                        const isLockedByScore = p.unlocksAt && previousLevelScore < p.unlocksAt;
                        const isManuallyUnlocked = manualUnlocks.includes(p.id);
                        const isLocked = isLockedByScore && !isManuallyUnlocked;

                        return (
                            <div
                                key={p.id}
                                onClick={() => !isLocked && setSelectedProgramId(p.id)}
                                className={`bg-white rounded-xl shadow-md p-6 flex items-start gap-4 transition-all duration-300 relative overflow-hidden ${isLocked ? '' : 'cursor-pointer hover:shadow-xl hover:scale-[1.02]'}`}
                            >
                                {isLocked && <div className="absolute inset-0 bg-slate-200 bg-opacity-60 backdrop-blur-sm z-10"></div>}
                                <div className="p-3 bg-sky-100 rounded-full flex items-center justify-center w-16 h-16 flex-shrink-0">
                                   <span className="text-3xl">{p.Icon}</span>
                                </div>
                                <div className="flex-grow z-20">
                                    <p className="text-sm font-bold text-sky-600 uppercase tracking-wider">{p.name}</p>
                                    <h2 className="text-xl font-bold text-slate-800 mt-1">{p.subtitle}</h2>
                                    <p className="text-slate-500 mt-2 flex-grow">{p.description}</p>
                                </div>
                                <div className="z-20 self-center">
                                    {isLocked ? (
                                        <div className="flex flex-col items-center text-center p-2 bg-slate-100 rounded-lg">
                                            <LockIcon className="w-6 h-6 text-slate-500 mb-1"/>
                                            <span className="text-xs font-semibold text-slate-600">Bloccato</span>
                                            <span className="text-xs text-slate-500">Raggiungi {p.unlocksAt} punti nel livello precedente.</span>
                                        </div>
                                    ) : (
                                        <span className="text-sky-600 font-semibold inline-block">Inizia →</span>
                                    )}
                                </div>
                            </div>
                        );
                    })}
                </div>
            </>
        );

        return (
            <div className="p-4 md:p-8 animate-fade-in">
                <h1 className="text-4xl font-bold text-slate-800 mb-2">Programmi di Benessere</h1>
                <p className="text-xl text-slate-600 mb-8">Scegli la missione più adatta ai tuoi obiettivi di oggi.</p>
                
                <div
                    key={startProgram.id}
                    onClick={() => setSelectedProgramId(startProgram.id)}
                    className="bg-white rounded-xl shadow-lg p-6 flex flex-col md:flex-row items-center gap-6 cursor-pointer hover:shadow-xl hover:scale-[1.02] transition-all duration-300 animate-slide-in-up mb-8 border-2 border-sky-500"
                >
                    <div className="p-3 bg-sky-100 rounded-full flex items-center justify-center w-20 h-20 flex-shrink-0">
                       <span className="text-4xl">{startProgram.Icon}</span>
                    </div>
                    <div>
                        <h2 className="text-2xl font-bold text-slate-800">{startProgram.name}</h2>
                        <p className="text-slate-500 mt-2">{startProgram.description}</p>
                        <span className="mt-4 text-sky-600 font-bold inline-block">Inizia Programma →</span>
                    </div>
                </div>
                
                <ProgramSection title="Programma Alimentare" programs={foodPrograms} icon="🥗" />
                <ProgramSection title="Programma Sonno" programs={sleepPrograms} icon="🌙" />
                <ProgramSection title="Programma Ansia-Stress" programs={anxietyPrograms} icon="🌿" />
                <ProgramSection title="Programma Attività Fisica" programs={activityPrograms} icon="🏃‍♂️" />

                <div className="relative my-10 text-center">
                    <div className="absolute inset-0 flex items-center" aria-hidden="true"><div className="w-full border-t border-slate-300"></div></div>
                    <div className="relative flex justify-center"><span className="bg-slate-50 px-4 text-xl font-bold text-slate-700">PROGRAMMI SMART</span></div>
                </div>
                <p className="text-center text-slate-600 -mt-6 mb-8 max-w-3xl mx-auto">
                    Questi percorsi bonus sono pensati per darti flessibilità. Usali per esplorare nuove abitudini di benessere senza l'impegno delle missioni a punteggio. I punti ottenuti qui non verranno salvati e non contribuiranno a sbloccare i livelli successivi dei programmi principali.
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {otherPrograms.map(p => {
                         return (
                             <div
                                key={p.id}
                                onClick={() => setSelectedProgramId(p.id)}
                                className={`bg-white rounded-xl shadow-md p-6 flex flex-col items-start transition-all duration-300 animate-slide-in-up cursor-pointer hover:shadow-xl hover:scale-105`}
                            >
                                <div className="p-3 bg-sky-100 rounded-full mb-4 flex items-center justify-center w-16 h-16">
                                   <span className="text-3xl">{p.Icon}</span>
                                </div>
                                <h2 className="text-xl font-bold text-slate-800">{p.name}</h2>
                                <p className="text-slate-500 mt-2 flex-grow">{p.description}</p>
                                <span className="mt-4 text-sky-600 font-semibold">Inizia Programma →</span>
                            </div>
                        );
                    })}
                </div>
            </div>
        );
    }
    
     const MissionItem = ({ mission, isCompleted, onToggle, isReminderActive, onToggleReminder }) => (
        <div 
            onClick={onToggle}
            role="button"
            tabIndex={0}
            onKeyPress={(e) => (e.key === 'Enter' || e.key === ' ') && onToggle()}
            className={`p-4 flex items-start gap-4 border-b border-slate-100 last:border-b-0 cursor-pointer transition-all duration-300 ${isCompleted ? 'bg-green-50' : 'bg-white hover:bg-slate-50'}`}
        >
            <div className="p-3 bg-sky-100 rounded-full flex items-center justify-center w-12 h-12">
                <span className="text-2xl">{mission.Icon}</span>
            </div>
            <div className="flex-grow">
                <h4 className={`font-bold text-slate-800 ${isCompleted ? 'line-through text-slate-500' : ''}`}>{mission.title} <span className="text-sm font-medium text-sky-600">({mission.points} Punti)</span></h4>
                <p className="text-slate-500 text-sm">{mission.description}</p>
            </div>
            <div className="flex-shrink-0 mt-1 flex items-center gap-3">
                 {mission.remindable && (
                    <button 
                        onClick={(e) => { e.stopPropagation(); onToggleReminder(mission.id); }}
                        className={`p-1 rounded-full transition-colors ${isReminderActive ? 'text-sky-600 bg-sky-100' : 'text-slate-400 hover:bg-slate-100'}`}
                        title={isReminderActive ? 'Disattiva promemoria' : 'Attiva promemoria'}
                    >
                        <BellIcon className="w-5 h-5" />
                    </button>
                )}
                <div className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all ${isCompleted ? 'bg-sky-500 border-sky-500' : 'border-slate-400'}`}>
                    {isCompleted && <svg className="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M5 13l4 4L19 7" /></svg>}
                </div>
            </div>
        </div>
    );
    
    const selectedWeekLabel = weeks.find(w => w.value === selectedWeek)?.label || '';

    return (
        <div className="p-4 md:p-8 animate-fade-in">
            <button onClick={() => setSelectedProgramId(null)} className="flex items-center gap-2 text-sky-600 font-semibold mb-6 hover:text-sky-800 transition-colors">
                <ArrowLeftIcon className="w-5 h-5" />
                <span>Tutti i Programmi</span>
            </button>

            <h1 className="text-4xl font-bold text-slate-800 mb-2">{program.name}</h1>
            <p className="text-xl text-slate-600 mb-8">{program.description}</p>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                {program.daily && program.daily.length > 0 && (
                <div className="bg-white p-6 rounded-2xl shadow-lg">
                    <div className="flex justify-between items-baseline">
                        <h3 className="font-bold text-lg text-slate-700">Punteggio per {selectedDay}</h3>
                        {program.dailyTarget && <small className="text-slate-500 font-medium">🎯 Obiettivo: {program.dailyTarget}{program.dailyMaxTarget ? ` - ${program.dailyMaxTarget}` : ''} Punti</small>}
                    </div>
                    <p className="text-3xl font-bold text-sky-600 my-2">{dailyScore} <span className="text-lg text-slate-500 font-medium">/ {dailyMax} Punti</span></p>
                    <div className="w-full bg-slate-200 rounded-full h-2.5"><div className="bg-sky-500 h-2.5 rounded-full" style={{width: `${dailyProgress}%`, transition: 'width 0.5s'}}></div></div>
                </div>
                )}
                 {program.weekly && program.weekly.length > 0 && (
                <div className="bg-white p-6 rounded-2xl shadow-lg">
                     <div className="flex justify-between items-baseline">
                        <h3 className="font-bold text-lg text-slate-700">Punteggio per {selectedWeekLabel}</h3>
                        {program.weeklyMinTarget && <small className="text-slate-500 font-medium">🎯 Obiettivo: {program.weeklyMinTarget}{program.weeklyMaxTarget ? ` - ${program.weeklyMaxTarget}` : ''} Punti</small>}
                    </div>
                    <p className="text-3xl font-bold text-sky-600 my-2">{weeklyScore} <span className="text-lg text-slate-500 font-medium">/ {weeklyMax} Punti</span></p>
                    <div className="w-full bg-slate-200 rounded-full h-2.5"><div className="bg-sky-500 h-2.5 rounded-full" style={{width: `${weeklyProgress}%`, transition: 'width 0.5s'}}></div></div>
                </div>
                )}
            </div>

            <div className="grid grid-cols-1 xl:grid-cols-2 gap-8">
                {program.daily && program.daily.length > 0 && (
                    <div className="bg-white p-2 rounded-2xl shadow-lg">
                        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 gap-4">
                             <div>
                                <h2 className="text-2xl font-bold text-slate-800">Missioni Giornaliere</h2>
                                {program.subtitle && <p className="text-slate-500 mt-1 font-semibold">{program.subtitle}</p>}
                             </div>
                             <select 
                                value={selectedDay} 
                                onChange={e => setSelectedDay(e.target.value)}
                                className="p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500"
                            >
                                {daysOfWeek.map(day => <option key={day} value={day}>{day}</option>)}
                            </select>
                        </div>
                        {program.daily.map(mission => (
                            <MissionItem 
                                key={mission.id} 
                                mission={mission} 
                                isCompleted={missionsData.daily[selectedDay]?.has(mission.id)} 
                                onToggle={() => handleToggleMission(mission, 'daily')}
                                isReminderActive={activeReminders.has(mission.id)}
                                onToggleReminder={handleToggleReminder}
                            />
                        ))}
                    </div>
                )}
                {program.weekly && program.weekly.length > 0 && (
                     <div className="bg-white p-2 rounded-2xl shadow-lg">
                        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 gap-4">
                            <div>
                                <h2 className="text-2xl font-bold text-slate-800">Missioni Settimanali</h2>
                                {program.subtitle && <p className="text-slate-500 mt-1 font-semibold">{program.subtitle}
        </p>}
                             </div>
                             <select 
                                value={selectedWeek} 
                                onChange={e => setSelectedWeek(e.target.value)}
                                className="p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500"
                            >
                                {weeks.map(week => <option key={week.value} value={week.value}>{week.label}</option>)}
                            </select>
                        </div>
                        {program.weekly.map(mission => (
                            <MissionItem 
                                key={mission.id} 
                                mission={mission} 
                                isCompleted={missionsData.weekly[selectedWeek]?.has(mission.id)} 
                                onToggle={() => handleToggleMission(mission, 'weekly')}
                                isReminderActive={activeReminders.has(mission.id)}
                                onToggleReminder={handleToggleReminder}
                            />
                        ))}
                    </div>
                )}
            </div>
        </div>
    );
};


const App = () => {
    const [user, setUser] = React.useState(null);
    const [currentPage, setCurrentPage] = React.useState('home');
    const [isSidebarOpen, setIsSidebarOpen] = React.useState(false);
    const [notification, setNotification] = React.useState(null);
    const [currentAssessmentId, setCurrentAssessmentId] = React.useState(null);
    const [currentScore, setCurrentScore] = React.useState(null);

    React.useEffect(() => {
        const storedUser = localStorage.getItem('wellnessUser');
        if (storedUser) {
            setUser(JSON.parse(storedUser));
        }
    }, []);

    const showNotification = (message, type = 'success') => {
        setNotification({ message, type });
    };

    const handleLogin = (loggedInUser) => {
        setUser(loggedInUser);
        localStorage.setItem('wellnessUser', JSON.stringify(loggedInUser));
        setCurrentPage('home');
    };

    const handleLogout = () => {
        setUser(null);
        localStorage.removeItem('wellnessUser');
        setCurrentPage('home');
    };

    const handleNavigate = (page) => {
        setCurrentPage(page);
        window.scrollTo(0, 0);
    };

    const handleStartAssessment = (assessmentId) => {
        setCurrentAssessmentId(assessmentId);
        setCurrentScore(null); // Reset score
        handleNavigate('quiz');
    };

    const handleQuizComplete = (score) => {
        setCurrentScore(score);
        // Save to history
        const storageKey = `assessmentHistory_${user.email}_${currentAssessmentId}`;
        const history = JSON.parse(localStorage.getItem(storageKey) || '[]');
        history.push({ score, date: new Date().toISOString() });
        localStorage.setItem(storageKey, JSON.stringify(history));
        handleNavigate('results');
    };

    if (!user) {
        return <LoginScreen onLogin={handleLogin} />;
    }

    const renderPage = () => {
        switch (currentPage) {
            case 'home':
                return <HomeScreen user={user} onNavigate={handleNavigate} />;
            case 'profile':
                return <ProfileScreen user={user} onLogout={handleLogout} onNavigate={handleNavigate}/>;
             case 'manualUnlock':
                return <ManualUnlockScreen user={user} onNavigate={handleNavigate} showNotification={showNotification}/>;
            case 'assessments':
                return <AssessmentScreen onNavigate={handleNavigate} onStartAssessment={handleStartAssessment}/>;
            case 'quiz':
                return <Quiz assessment={assessmentsData[currentAssessmentId]} onComplete={handleQuizComplete} />;
            case 'results':
                return <Results
                    assessment={assessmentsData[currentAssessmentId]}
                    score={currentScore}
                    onRetake={() => handleStartAssessment(currentAssessmentId)}
                    onBackToHome={() => handleNavigate('assessments')}
                />;
            case 'dashboard':
                return <WellnessDashboard user={user} onNavigate={handleNavigate} />;
            case 'breathing':
                return <BreathingScreen />;
            case 'bloodAnalysis':
                return <BloodAnalysisScreen user={user} />;
            case 'prescriptions':
                return <PrescriptionScreen user={user} showNotification={showNotification} />;
            case 'bookings':
                return <TreatmentsScreen user={user} showNotification={showNotification} />;
            case 'wellnessRoutine':
                return <WellnessRoutineScreen user={user} showNotification={showNotification} />;
            default:
                return <HomeScreen user={user} onNavigate={handleNavigate} />;
        }
    };

    return (
        <div className="flex">
            {notification && <Notification notification={notification} onClose={() => setNotification(null)}/>}
            <Sidebar 
                user={user} 
                currentPage={currentPage} 
                onNavigate={handleNavigate} 
                onLogout={handleLogout}
                isOpen={isSidebarOpen}
                setIsOpen={setIsSidebarOpen}
            />
            <div className="flex-1 md:ml-64 transition-all duration-300">
                <button 
                    className="md:hidden fixed top-4 right-4 z-50 p-2 bg-white rounded-full shadow-lg"
                    onClick={() => setIsSidebarOpen(!isSidebarOpen)}
                >
                    {isSidebarOpen ? <XIcon className="w-6 h-6"/> : <MenuIcon className="w-6 h-6"/>}
                </button>
                <main>{renderPage()}</main>
            </div>
        </div>
    );
};

// --- RENDER APP ---
const container = document.getElementById('root');
const root = ReactDOM.createRoot(container);
root.render(<App />);

// PWA Service Worker Registration
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js', { scope: './' })
      .then(registration => {
        console.log('Service Worker registered: ', registration);
      })
      .catch(registrationError => {
        console.log('Service Worker registration failed: ', registrationError);
      });
  });
}

</script>
<script type="module" src="/index.tsx"></script>
</body>
</html>